(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78072,e=>{"use strict";var a=e.i(43476),s=e.i(27341),l=e.i(66027),r=e.i(54616),t=e.i(12598),i=e.i(5151),n=e.i(47627),o=e.i(67881),c=e.i(7233),d=e.i(55436),m=e.i(37727),u=e.i(75254);let x=(0,u.default)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var h=e.i(88699),j=e.i(27612),g=e.i(56909);let p=(0,u.default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var b=e.i(23750),v=e.i(71645),N=e.i(30374),_=e.i(53145),f=e.i(94814),S=e.i(31278),F=e.i(74946),C=e.i(62870),y=e.i(25959),T=e.i(81307);let L=T.z.object({id_plantilla:T.z.string().min(1,"ID Plantilla es requerido"),nombre_generico:T.z.string().min(1,"El Nombre es requerido"),id_familia:T.z.string().optional().nullable(),id_sistema:T.z.string().optional().nullable(),largo_estandar_mm:T.z.coerce.number().min(0).optional().nullable(),peso_teorico_kg:T.z.coerce.number().min(0).optional().nullable(),imagen_ref:T.z.string().url("URL inv√°lida").optional().or(T.z.literal("")).nullable()}),P=T.z.object({id_sku:T.z.string().min(1,"SKU es requerido"),id_plantilla:T.z.string().min(1,"Plantilla es requerida"),id_marca:T.z.string().min(1,"Marca es requerida"),id_material:T.z.string().min(1,"Material es requerido"),id_acabado:T.z.string().min(1,"Acabado es requerido"),cod_proveedor:T.z.string().optional().nullable(),nombre_completo:T.z.string().min(1,"Nombre completo requerido"),unidad_medida:T.z.string().optional().nullable(),costo_mercado_unit:T.z.coerce.number().min(0,"El costo debe ser ‚â• 0").optional().nullable(),moneda_reposicion:T.z.enum(["PEN","USD"]).optional().nullable(),es_templado:T.z.boolean().optional().nullable(),espesor_mm:T.z.coerce.number().optional().nullable(),costo_flete_m2:T.z.coerce.number().optional().nullable(),stock_minimo:T.z.coerce.number().min(0).optional().nullable(),punto_pedido:T.z.coerce.number().min(0).optional().nullable(),tiempo_reposicion_dias:T.z.coerce.number().int().min(0).optional().nullable(),lote_econ_compra:T.z.coerce.number().min(0).optional().nullable(),demanda_promedio_diaria:T.z.coerce.number().min(0).optional().nullable()});var k=e.i(74117);function w({onSuccess:e,initialData:s}){let n=(0,t.useQueryClient)(),{toast:c}=(0,k.useToast)(),{data:d}=(0,l.useQuery)({queryKey:["catPlantillas"],queryFn:i.catApi.getPlantillas}),{data:m}=(0,l.useQuery)({queryKey:["mstMarcas"],queryFn:i.catApi.getMarcas}),{data:u}=(0,l.useQuery)({queryKey:["mstMateriales"],queryFn:i.catApi.getMateriales}),{data:x}=(0,l.useQuery)({queryKey:["mstAcabados"],queryFn:i.catApi.getAcabados}),h=(0,_.useForm)({resolver:(0,f.zodResolver)(P),defaultValues:{id_sku:s?.id_sku||"",id_plantilla:s?.id_plantilla||"",id_marca:s?.id_marca||"",id_material:s?.id_material||"",id_acabado:s?.id_acabado||"",cod_proveedor:s?.cod_proveedor||"",nombre_completo:s?.nombre_completo||"",unidad_medida:s?.unidad_medida||"",costo_mercado_unit:s?.costo_mercado_unit?Number(s.costo_mercado_unit):0,moneda_reposicion:s?.moneda_reposicion||"PEN",es_templado:s?.es_templado||!1,espesor_mm:s?.espesor_mm?Number(s.espesor_mm):0,costo_flete_m2:s?.costo_flete_m2?Number(s.costo_flete_m2):0,stock_minimo:s?.stock_minimo?Number(s.stock_minimo):0,punto_pedido:s?.punto_pedido?Number(s.punto_pedido):0,tiempo_reposicion_dias:s?.tiempo_reposicion_dias?Number(s.tiempo_reposicion_dias):7,lote_econ_compra:s?.lote_econ_compra?Number(s.lote_econ_compra):1,demanda_promedio_diaria:s?.demanda_promedio_diaria?Number(s.demanda_promedio_diaria):0}}),[j,g,p,N]=h.watch(["id_material","id_plantilla","id_acabado","id_marca"]),T=j?.includes("CR")||u?.find(e=>e.id_material===j)?.nombre_material?.toLowerCase().includes("vidrio");(0,v.useEffect)(()=>{if(j&&g&&p&&N){let e=`${j}-${g}-${p}-${N}`;h.setValue("id_sku",e,{shouldValidate:!0})}},[j,g,p,N,h]);let L=(0,r.useMutation)({mutationFn:i.catApi.createProducto,onSuccess:()=>{n.invalidateQueries({queryKey:["catProductos"]}),c({title:"¬°Producto creado exitosamente!",variant:"default"}),h.reset(),e?.()},onError:e=>{console.error(e),c({title:"Error al crear producto: "+e.message,variant:"destructive"})}}),w=(0,r.useMutation)({mutationFn:e=>i.catApi.updateProducto(s.id_sku,e),onSuccess:()=>{n.invalidateQueries({queryKey:["catProductos"]}),c({title:"Producto actualizado correctamente",variant:"default"}),e?.()},onError:e=>{console.error(e),c({title:"Error al actualizar: "+e.message,variant:"destructive"})}}),I=L.isPending||w.isPending;return(0,a.jsx)(F.Form,{...h,children:(0,a.jsxs)("form",{onSubmit:h.handleSubmit(function(e){s?w.mutate(e):L.mutate(e)}),className:"space-y-5 max-h-[70vh] overflow-y-auto pr-2",children:[(0,a.jsx)(F.FormField,{control:h.control,name:"id_sku",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"SKU (C√≥digo √önico)"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{placeholder:"Se genera autom√°ticamente",...e,readOnly:!0,className:"bg-muted font-mono"})}),(0,a.jsx)(F.FormDescription,{children:"Auto-generado: MATERIAL-PLANTILLA-ACABADO-MARCA"}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsx)(F.FormField,{control:h.control,name:"nombre_completo",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Nombre del Producto *"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{placeholder:"Ej: Felpa 80",...e})}),(0,a.jsx)(F.FormMessage,{})]})})}),(0,a.jsx)(F.FormField,{control:h.control,name:"cod_proveedor",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"C√≥d. Proveedor"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{placeholder:"Opcional",...e,value:e.value||""})}),(0,a.jsx)(F.FormMessage,{})]})})]}),(0,a.jsxs)("div",{className:"border p-4 rounded-md space-y-3",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-muted-foreground",children:"Componentes del SKU (obligatorios)"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(F.FormField,{control:h.control,name:"id_material",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Material Base *"}),(0,a.jsxs)(C.Select,{onValueChange:e.onChange,defaultValue:e.value||void 0,children:[(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{placeholder:"Seleccionar"})})}),(0,a.jsx)(C.SelectContent,{children:u?.map(e=>(0,a.jsxs)(C.SelectItem,{value:e.id_material,children:[e.nombre_material," (",e.id_material,")"]},e.id_material))})]}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:h.control,name:"id_plantilla",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Plantilla *"}),(0,a.jsxs)(C.Select,{onValueChange:e.onChange,defaultValue:e.value||void 0,children:[(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{placeholder:"Seleccionar"})})}),(0,a.jsx)(C.SelectContent,{children:d?.map(e=>(0,a.jsxs)(C.SelectItem,{value:e.id_plantilla,children:[e.nombre_generico," (",e.id_plantilla,")"]},e.id_plantilla))})]}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:h.control,name:"id_acabado",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Acabado/Color *"}),(0,a.jsxs)(C.Select,{onValueChange:e.onChange,defaultValue:e.value||void 0,children:[(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{placeholder:"Seleccionar"})})}),(0,a.jsx)(C.SelectContent,{children:x?.map(e=>(0,a.jsxs)(C.SelectItem,{value:e.id_acabado,children:[e.nombre_acabado," (",e.id_acabado,")"]},e.id_acabado))})]}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:h.control,name:"id_marca",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Marca *"}),(0,a.jsxs)(C.Select,{onValueChange:e.onChange,defaultValue:e.value||void 0,children:[(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{placeholder:"Seleccionar"})})}),(0,a.jsx)(C.SelectContent,{children:m?.map(e=>(0,a.jsxs)(C.SelectItem,{value:e.id_marca,children:[e.nombre_marca," (",e.id_marca,")"]},e.id_marca))})]}),(0,a.jsx)(F.FormMessage,{})]})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsx)(F.FormField,{control:h.control,name:"unidad_medida",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Unidad Medida"}),(0,a.jsxs)(C.Select,{onValueChange:e.onChange,defaultValue:e.value||void 0,children:[(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{placeholder:"Seleccionar"})})}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"UND",children:"Unidad (Pza)"}),(0,a.jsx)(C.SelectItem,{value:"M",children:"Metro Lineal (m)"}),(0,a.jsx)(C.SelectItem,{value:"M2",children:"Metro Cuadrado (m¬≤)"}),(0,a.jsx)(C.SelectItem,{value:"KG",children:"Kilogramo (kg)"}),(0,a.jsx)(C.SelectItem,{value:"L",children:"Litro (L)"}),(0,a.jsx)(C.SelectItem,{value:"GLB",children:"Global"})]})]}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:h.control,name:"costo_mercado_unit",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Costo Mercado (Reposici√≥n)"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{type:"number",step:"0.01",...e,value:e.value??0,onChange:a=>e.onChange(Number(a.target.value))})}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:h.control,name:"moneda_reposicion",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Moneda"}),(0,a.jsxs)(C.Select,{onValueChange:e.onChange,defaultValue:e.value||"PEN",children:[(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{placeholder:"Moneda"})})}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"PEN",children:"Soles (S/)"}),(0,a.jsx)(C.SelectItem,{value:"USD",children:"D√≥lares ($)"})]})]}),(0,a.jsx)(F.FormMessage,{})]})})]}),T&&(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 border p-4 rounded-md bg-blue-50 dark:bg-blue-950/20",children:[(0,a.jsx)("div",{className:"col-span-3 text-sm font-semibold text-blue-700 dark:text-blue-400",children:"ü™ü Propiedades de Vidrio"}),(0,a.jsx)(F.FormField,{control:h.control,name:"es_templado",render:({field:e})=>(0,a.jsxs)(F.FormItem,{className:"flex flex-row items-center space-x-3 space-y-0 p-2",children:[(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(y.Checkbox,{checked:e.value||!1,onCheckedChange:e.onChange})}),(0,a.jsx)("div",{className:"space-y-1 leading-none",children:(0,a.jsx)(F.FormLabel,{children:"¬øTemplado?"})})]})}),(0,a.jsx)(F.FormField,{control:h.control,name:"espesor_mm",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Espesor (mm)"}),(0,a.jsxs)(C.Select,{onValueChange:a=>e.onChange(Number(a)),defaultValue:e.value?.toString()||void 0,children:[(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{placeholder:"Seleccionar"})})}),(0,a.jsx)(C.SelectContent,{children:[2,3,4,5,6,8,10,12,15,19].map(e=>(0,a.jsxs)(C.SelectItem,{value:e.toString(),children:[e," mm"]},e))})]}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:h.control,name:"costo_flete_m2",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Costo Flete x m¬≤"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{type:"number",step:"0.01",...e,value:e.value??0,onChange:a=>e.onChange(Number(a.target.value))})}),(0,a.jsx)(F.FormMessage,{})]})})]}),(0,a.jsxs)("div",{className:"border p-4 rounded-md space-y-3 bg-slate-50 dark:bg-slate-900",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-muted-foreground",children:"üì¶ Par√°metros de Inventario"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsx)(F.FormField,{control:h.control,name:"stock_minimo",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Stock M√≠nimo"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{type:"number",step:"0.01",...e,value:e.value??0,onChange:a=>e.onChange(Number(a.target.value))})}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:h.control,name:"punto_pedido",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Punto de Pedido"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{type:"number",step:"0.01",...e,value:e.value??0,onChange:a=>e.onChange(Number(a.target.value))})}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:h.control,name:"tiempo_reposicion_dias",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Lead Time (d√≠as)"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{type:"number",step:"1",...e,value:e.value??7,onChange:a=>e.onChange(Number(a.target.value))})}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:h.control,name:"lote_econ_compra",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Lote Econ√≥mico"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{type:"number",step:"0.01",...e,value:e.value??1,onChange:a=>e.onChange(Number(a.target.value))})}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:h.control,name:"demanda_promedio_diaria",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Demanda Diaria Prom."}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{type:"number",step:"0.01",...e,value:e.value??0,onChange:a=>e.onChange(Number(a.target.value))})}),(0,a.jsx)(F.FormMessage,{})]})})]})]}),(0,a.jsx)("div",{className:"flex justify-end pt-4 sticky bottom-0 bg-background pb-2",children:(0,a.jsxs)(o.Button,{type:"submit",disabled:I,children:[I&&(0,a.jsx)(S.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),s?"Actualizar Producto":"Crear Producto"]})})]})})}var I=e.i(26999),A=e.i(25913),M=e.i(47163);let D=I.Root,E=I.Trigger;I.Close;let z=I.Portal,V=v.forwardRef(({className:e,...s},l)=>(0,a.jsx)(I.Overlay,{className:(0,M.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:l}));V.displayName=I.Overlay.displayName;let q=(0,A.cva)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),K=v.forwardRef(({side:e="right",className:s,children:l,...r},t)=>(0,a.jsxs)(z,{children:[(0,a.jsx)(V,{}),(0,a.jsxs)(I.Content,{ref:t,className:(0,M.cn)(q({side:e}),s),...r,children:[(0,a.jsxs)(I.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(m.X,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]}),l]})]}));K.displayName=I.Content.displayName;let B=({className:e,...s})=>(0,a.jsx)("div",{className:(0,M.cn)("flex flex-col space-y-2 text-center sm:text-left",e),...s});B.displayName="SheetHeader";let R=v.forwardRef(({className:e,...s},l)=>(0,a.jsx)(I.Title,{ref:l,className:(0,M.cn)("text-lg font-semibold text-foreground",e),...s}));R.displayName=I.Title.displayName;let U=v.forwardRef(({className:e,...s},l)=>(0,a.jsx)(I.Description,{ref:l,className:(0,M.cn)("text-sm text-muted-foreground",e),...s}));U.displayName=I.Description.displayName;var H=e.i(69035);function Q({product:e,children:s}){if(!e)return(0,a.jsx)(a.Fragment,{children:s});let l=Number(e.stock_actual)||0,r=Number(e.inversion_total)||0,t=Number(e.costo_promedio)||0,i=l<0;return(0,a.jsxs)(D,{children:[(0,a.jsx)(E,{asChild:!0,children:s}),(0,a.jsxs)(K,{className:"w-[400px] sm:w-[540px] overflow-y-auto",children:[(0,a.jsxs)(B,{children:[(0,a.jsx)(R,{children:e.id_sku}),(0,a.jsx)(U,{children:e.nombre_completo})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,a.jsx)("div",{className:`p-4 rounded-lg border ${i?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Stock Actual"}),(0,a.jsxs)("p",{className:`text-2xl font-bold ${i?"text-red-700":"text-green-700"}`,children:[l.toLocaleString("es-PE")," ",(0,a.jsx)("span",{className:"text-sm font-normal",children:e.unidad_medida})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Valorizado (PEN)"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-800",children:r.toLocaleString("es-PE",{style:"currency",currency:"PEN"})})]})]})}),(0,a.jsx)(H.Separator,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-sm",children:"Ficha T√©cnica"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-y-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Familia"}),(0,a.jsx)("p",{children:e.nombre_familia})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Sistema"}),(0,a.jsx)("p",{className:"font-medium",children:e.sistema_nombre||e.id_sistema||"-"})]}),e.id_sistema&&(0,a.jsxs)("div",{className:"col-span-2 border rounded-md p-2 bg-muted/20 mt-2",children:[(0,a.jsxs)("p",{className:"text-xs font-semibold mb-2",children:["Equivalencias del Sistema (",e.id_sistema,")"]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-[10px] text-muted-foreground block",children:"Corrales"}),(0,a.jsx)("span",{className:"font-mono",children:e.cod_corrales||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-[10px] text-muted-foreground block",children:"Eduholding"}),(0,a.jsx)("span",{className:"font-mono",children:e.cod_eduholding||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-[10px] text-muted-foreground block",children:"HPD"}),(0,a.jsx)("span",{className:"font-mono",children:e.cod_hpd||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-[10px] text-muted-foreground block",children:"Limatambo"}),(0,a.jsx)("span",{className:"font-mono",children:e.cod_limatambo||"-"})]})]}),e.sistema_uso&&(0,a.jsxs)("div",{className:"mt-2 text-xs italic text-muted-foreground",children:["Uso: ",e.sistema_uso]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Marca"}),(0,a.jsx)("p",{children:e.nombre_marca})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Cod. Proveedor"}),(0,a.jsx)("p",{className:"font-mono",children:e.cod_proveedor||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Sistema / Serie"}),(0,a.jsx)("p",{className:"font-medium",children:e.id_sistema||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Largo Est√°ndar"}),(0,a.jsx)("p",{children:e.largo_estandar_mm?`${Number(e.largo_estandar_mm).toLocaleString()} mm`:"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Peso Te√≥rico"}),(0,a.jsx)("p",{children:e.peso_teorico_kg?`${Number(e.peso_teorico_kg).toFixed(3)} Kg/m`:"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Costo PMP Unitario"}),(0,a.jsx)("p",{children:t.toLocaleString("es-PE",{style:"currency",currency:"PEN"})})]})]}),e.imagen_ref&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"Referencia Visual"}),(0,a.jsx)("img",{src:e.imagen_ref,alt:"Referencia",className:"rounded-md w-full h-auto object-cover border bg-white"})]})]}),(0,a.jsx)(H.Separator,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-sm mb-2",children:"Acciones R√°pidas"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Aqu√≠ podr√≠as ver los √∫ltimos 5 movimientos o ir directo al Kardex filtrado por este SKU."})]})]})]})]})}var O=e.i(10708),$=e.i(84762),G=e.i(89464);function J({open:e,onOpenChange:s,product:l}){let i=(0,t.useQueryClient)(),[n,c]=(0,v.useState)(""),[d,m]=(0,v.useState)(""),u=Number(l?.stock_actual||0),x=Number(n),h=isNaN(x)?0:x-u,j=0===h,g=(0,r.useMutation)({mutationFn:async()=>{if(j)return;let e=Math.abs(h);h>0?await G.trxApi.createEntrada({tipo_entrada:"AJUSTE_POSITIVO",moneda:"PEN",tipo_cambio:1,detalles:[{id_sku:l.id_sku,cantidad:e,costo_unitario:0}],comentarios:`Ajuste Inventario. Stock Sistema: ${u}. F\xedsico: ${x}. ${d}`,estado:"INGRESADO"}):await G.trxApi.createSalida({tipo_salida:"AJUSTE_NEGATIVO",detalles:[{id_sku:l.id_sku,cantidad:e,precio_unitario:0}],comentario:`Ajuste Inventario. Stock Sistema: ${u}. F\xedsico: ${x}. ${d}`,estado:"CONFIRMADO"})},onSuccess:()=>{i.invalidateQueries({queryKey:["catProductos"]}),i.invalidateQueries({queryKey:["trxMovimientos"]}),alert("Ajuste registrado correctamente."),s(!1),c(""),m("")},onError:e=>{console.error(e),alert("Error al registrar ajuste.")}});return l?(0,a.jsx)(N.Dialog,{open:e,onOpenChange:s,children:(0,a.jsxs)(N.DialogContent,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(N.DialogHeader,{children:[(0,a.jsx)(N.DialogTitle,{children:"Ajuste R√°pido de Stock"}),(0,a.jsx)(N.DialogDescription,{children:"Ingrese la cantidad f√≠sica contada. El sistema calcular√° la diferencia."})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(O.Label,{className:"text-right",children:"Producto"}),(0,a.jsx)("div",{className:"col-span-3 text-sm font-medium",children:l.nombre_completo})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(O.Label,{className:"text-right",children:"Stock Sistema"}),(0,a.jsx)("div",{className:"col-span-3 text-sm font-mono",children:u})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(O.Label,{htmlFor:"physical",className:"text-right",children:"Conteo F√≠sico"}),(0,a.jsx)(b.Input,{id:"physical",type:"number",value:n,onChange:e=>c(e.target.value),className:"col-span-3",placeholder:"Ej. 15",autoFocus:!0})]}),""!==n&&!j&&(0,a.jsxs)("div",{className:`text-center p-2 rounded text-sm font-bold ${h>0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:["Diferencia: ",h>0?"+":"",h,(0,a.jsxs)("span",{className:"block text-xs font-normal opacity-80",children:["(",h>0?"Entrada / Sobrante":"Salida / Faltante",")"]})]}),j&&""!==n&&(0,a.jsx)("div",{className:"text-center p-2 rounded bg-gray-100 text-gray-500 text-sm",children:"Sin variaciones."}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(O.Label,{htmlFor:"comments",className:"text-right",children:"Notas"}),(0,a.jsx)($.Textarea,{id:"comments",value:d,onChange:e=>m(e.target.value),className:"col-span-3",placeholder:"Raz√≥n del ajuste..."})]})]}),(0,a.jsxs)(N.DialogFooter,{children:[(0,a.jsx)(o.Button,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),(0,a.jsxs)(o.Button,{onClick:()=>{""!==n&&g.mutate()},disabled:g.isPending||""===n||j,children:[g.isPending&&(0,a.jsx)(S.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirmar Ajuste"]})]})]})}):null}function X({open:e,onOpenChange:s,product:l}){let[n,c]=(0,v.useState)(""),d=(0,t.useQueryClient)();(0,v.useEffect)(()=>{e&&l&&c(l.costo_estandar?.toString()||"0")},[e,l]);let m=(0,r.useMutation)({mutationFn:async()=>{if(!l)return;let e=parseFloat(n);if(isNaN(e))throw Error("El costo debe ser un n√∫mero v√°lido");await i.catApi.updatePrecioMercado(l.id_sku,e)},onSuccess:()=>{alert("Costo de mercado actualizado correctamente"),d.invalidateQueries({queryKey:["catProductos"]}),s(!1)},onError:e=>{alert("Error al actualizar el costo: "+e.message)}}),u=e=>{e.preventDefault(),m.mutate()};return l?(0,a.jsx)(N.Dialog,{open:e,onOpenChange:s,children:(0,a.jsxs)(N.DialogContent,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(N.DialogHeader,{children:[(0,a.jsx)(N.DialogTitle,{children:"Actualizar Costo de Mercado"}),(0,a.jsxs)(N.DialogDescription,{children:["Este costo se utilizar√° como referencia predeterminada en las cotizaciones para el SKU: ",(0,a.jsx)("strong",{children:l.id_sku})]})]}),(0,a.jsx)("form",{onSubmit:u,className:"space-y-4 py-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(O.Label,{htmlFor:"costo",className:"text-right",children:"Costo Unit."}),(0,a.jsx)("div",{className:"col-span-3",children:(0,a.jsx)(b.Input,{id:"costo",type:"number",step:"0.01",value:n,onChange:e=>c(e.target.value),placeholder:"0.00"})})]})}),(0,a.jsxs)(N.DialogFooter,{children:[(0,a.jsx)(o.Button,{variant:"outline",onClick:()=>s(!1),disabled:m.isPending,children:"Cancelar"}),(0,a.jsxs)(o.Button,{onClick:u,disabled:m.isPending,children:[m.isPending&&(0,a.jsx)(S.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardar Cambio"]})]})]})}):null}function W({active:e}){let s=(0,t.useQueryClient)(),{toast:u}=(0,k.useToast)(),{data:_}=(0,l.useQuery)({queryKey:["mstFamilias"],queryFn:i.catApi.getFamilias}),{data:f}=(0,l.useQuery)({queryKey:["mstMarcas"],queryFn:i.catApi.getMarcas}),{data:S}=(0,l.useQuery)({queryKey:["mstMateriales"],queryFn:i.catApi.getMateriales}),{data:F}=(0,l.useQuery)({queryKey:["mstAcabados"],queryFn:i.catApi.getAcabados}),{data:y}=(0,l.useQuery)({queryKey:["mstSistemas"],queryFn:i.catApi.getSistemas}),[T,L]=(0,v.useState)(""),[P,I]=(0,v.useState)(""),[A,M]=(0,v.useState)("ALL"),[D,E]=(0,v.useState)("ALL"),[z,V]=(0,v.useState)("ALL"),[q,K]=(0,v.useState)("ALL"),[B,R]=(0,v.useState)("ALL"),[U,H]=(0,v.useState)(0),[O,$]=(0,v.useState)(100),[G,W]=(0,v.useState)(!1),[Y,Z]=(0,v.useState)(!1),[ee,ea]=(0,v.useState)(null),[es,el]=(0,v.useState)(null),[er,et]=(0,v.useState)(null),[ei,en]=(0,v.useState)(null),[eo,ec]=(0,v.useState)(!1),[ed,em]=(0,v.useState)({}),{data:eu,isLoading:ex}=(0,l.useQuery)({queryKey:["catProductos",U,O,P,A,D,z,B,q],queryFn:()=>i.catApi.getProductos({page:U,pageSize:O,search:P,familia:A,marca:D,material:z,sistema:B,acabado:q}),enabled:e}),eh=eu?.data||[],ej=eu?.count||0,eg=Math.ceil(ej/O),ep=(0,r.useMutation)({mutationFn:i.catApi.deleteProducto,onSuccess:()=>{s.invalidateQueries({queryKey:["catProductos"]}),u({title:"Producto eliminado correctamente",variant:"default"}),el(null)},onError:e=>{u({title:"Error al eliminar producto: "+e.message,variant:"destructive"}),el(null)}}),eb=(0,r.useMutation)({mutationFn:i.catApi.updatePreciosMasivos,onSuccess:()=>{s.invalidateQueries({queryKey:["catProductos"]}),u({title:"Precios actualizados masivamente",variant:"default"}),em({}),ec(!1)},onError:e=>{u({title:"Error al actualizar precios: "+e.message,variant:"destructive"})}});return ex&&e&&!eh.length?(0,a.jsx)("div",{className:"p-8 text-center text-muted-foreground",children:"Cargando cat√°logo..."}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex w-full max-w-md gap-2",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(d.Search,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(b.Input,{placeholder:"Buscar SKU o nombre...",className:"pl-8",value:T,onChange:e=>L(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(I(T),H(0))}})]}),(0,a.jsxs)(o.Button,{variant:"secondary",onClick:()=>{I(T),H(0)},children:[(0,a.jsx)(d.Search,{className:"h-4 w-4 mr-2"}),"Buscar"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"mr-2 flex items-center gap-2 border-r pr-4",children:eo?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.Button,{variant:"default",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>{let e=Object.entries(ed).map(([e,a])=>({id_sku:e,costo_mercado_unit:a}));0===e.length?ec(!1):eb.mutate(e)},disabled:0===Object.keys(ed).length||eb.isPending,children:[(0,a.jsx)(g.Save,{className:"mr-2 h-4 w-4"}),"Guardar (",Object.keys(ed).length,")"]}),(0,a.jsxs)(o.Button,{variant:"ghost",onClick:()=>{ec(!1),em({})},children:[(0,a.jsx)(p,{className:"mr-2 h-4 w-4"}),"Cancelar"]})]}):(0,a.jsxs)(o.Button,{variant:"outline",onClick:()=>ec(!0),children:[(0,a.jsx)(x,{className:"mr-2 h-4 w-4"}),"Edici√≥n R√°pida"]})}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground hidden md:inline",children:"Mostrar:"}),(0,a.jsxs)(C.Select,{value:O.toString(),onValueChange:e=>{$(Number(e)),H(0)},children:[(0,a.jsx)(C.SelectTrigger,{className:"w-[80px]",children:(0,a.jsx)(C.SelectValue,{})}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"100",children:"100"}),(0,a.jsx)(C.SelectItem,{value:"500",children:"500"}),(0,a.jsx)(C.SelectItem,{value:"1000",children:"1000"})]})]}),(0,a.jsxs)(N.Dialog,{open:G,onOpenChange:W,children:[(0,a.jsx)(N.DialogTrigger,{asChild:!0,children:(0,a.jsxs)(o.Button,{children:[(0,a.jsx)(c.Plus,{className:"mr-2 h-4 w-4"}),"Nuevo SKU"]})}),(0,a.jsxs)(N.DialogContent,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(N.DialogHeader,{children:[(0,a.jsx)(N.DialogTitle,{children:"Registrar Nuevo Item (SKU)"}),(0,a.jsx)(N.DialogDescription,{children:"Cree un nuevo material o insumo (Perfil, Vidrio, Accesorio)."})]}),(0,a.jsx)(w,{onSuccess:()=>W(!1)})]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsxs)(C.Select,{value:A,onValueChange:e=>{M(e),H(0)},children:[(0,a.jsx)(C.SelectTrigger,{className:"w-[160px]",children:(0,a.jsx)(C.SelectValue,{placeholder:"Familia"})}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"ALL",children:"Todas Familias"}),_?.map(e=>(0,a.jsx)(C.SelectItem,{value:e.nombre_familia,children:e.nombre_familia},e.id_familia))]})]}),(0,a.jsxs)(C.Select,{value:D,onValueChange:e=>{E(e),H(0)},children:[(0,a.jsx)(C.SelectTrigger,{className:"w-[160px]",children:(0,a.jsx)(C.SelectValue,{placeholder:"Marca"})}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"ALL",children:"Todas Marcas"}),f?.map(e=>(0,a.jsx)(C.SelectItem,{value:e.nombre_marca,children:e.nombre_marca},e.id_marca))]})]}),(0,a.jsxs)(C.Select,{value:z,onValueChange:e=>{V(e),H(0)},children:[(0,a.jsx)(C.SelectTrigger,{className:"w-[160px]",children:(0,a.jsx)(C.SelectValue,{placeholder:"Material"})}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"ALL",children:"Todos Materiales"}),S?.map(e=>(0,a.jsx)(C.SelectItem,{value:e.nombre_material,children:e.nombre_material},e.id_material))]})]}),(0,a.jsxs)(C.Select,{value:B,onValueChange:e=>{R(e),H(0)},children:[(0,a.jsx)(C.SelectTrigger,{className:"w-[160px]",children:(0,a.jsx)(C.SelectValue,{placeholder:"Sistema"})}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"ALL",children:"Todos Sistemas"}),y?.map(e=>(0,a.jsx)(C.SelectItem,{value:e.id_sistema,children:e.nombre_comercial},e.id_sistema))]})]}),(0,a.jsxs)(C.Select,{value:q,onValueChange:e=>{K(e),H(0)},children:[(0,a.jsx)(C.SelectTrigger,{className:"w-[160px]",children:(0,a.jsx)(C.SelectValue,{placeholder:"Acabado"})}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"ALL",children:"Todos Acabados"}),F?.map(e=>(0,a.jsx)(C.SelectItem,{value:e.nombre_acabado,children:e.nombre_acabado},e.id_acabado))]})]}),(P||"ALL"!==A||"ALL"!==D||"ALL"!==z||"ALL"!==q||"ALL"!==B)&&(0,a.jsxs)(o.Button,{variant:"ghost",onClick:()=>{L(""),I(""),M("ALL"),E("ALL"),V("ALL"),K("ALL"),R("ALL"),H(0)},className:"text-red-500 hover:text-red-700 hover:bg-red-50 h-10 px-3",children:[(0,a.jsx)(m.X,{className:"mr-2 h-4 w-4"}),"Limpiar"]})]})]}),(0,a.jsxs)("div",{className:"border rounded-md bg-white dark:bg-gray-800 flex flex-col",children:[(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:(0,a.jsxs)(n.Table,{children:[(0,a.jsx)(n.TableHeader,{children:(0,a.jsxs)(n.TableRow,{children:[(0,a.jsx)(n.TableHead,{className:"w-[120px]",children:"SKU"}),(0,a.jsx)(n.TableHead,{children:"Producto"}),(0,a.jsx)(n.TableHead,{children:"Familia / Marca"}),(0,a.jsx)(n.TableHead,{children:"Acabado"}),(0,a.jsx)(n.TableHead,{className:"text-right w-[140px]",children:eo?"Costo (Edit)":"Costo Mercado"}),(0,a.jsx)(n.TableHead,{className:"text-right",children:"Stock Actual"}),(0,a.jsx)(n.TableHead,{className:"text-right",children:"PMP (Unit)"}),(0,a.jsx)(n.TableHead,{className:"text-right",children:"Inversi√≥n (Total)"}),(0,a.jsx)(n.TableHead,{className:"text-right",children:"Acciones"})]})}),(0,a.jsx)(n.TableBody,{children:0===eh.length?(0,a.jsx)(n.TableRow,{children:(0,a.jsx)(n.TableCell,{colSpan:9,className:"text-center h-24",children:"No se encontraron productos."})}):eh.map(e=>{let s=Number(e.stock_actual||0),l=Number(e.costo_promedio||0),r=void 0!==ed[e.id_sku]?ed[e.id_sku]:Number(e.costo_mercado_unit||0),t=Number(e.inversion_total||0),c="USD"===e.moneda_reposicion?"USD":"PEN",m=s<0,u=s>0,x=void 0!==ed[e.id_sku];return(0,a.jsxs)(n.TableRow,{className:`${m?"bg-red-50 dark:bg-red-900/10 hover:bg-red-100":"hover:bg-muted/50"}`,children:[(0,a.jsx)(n.TableCell,{className:"font-mono text-xs font-medium",children:e.id_sku}),(0,a.jsx)(n.TableCell,{children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-medium text-sm",children:e.nombre_completo}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:e.unidad_medida})]})}),(0,a.jsx)(n.TableCell,{children:(0,a.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,a.jsx)("span",{children:e.nombre_familia}),(0,a.jsx)("span",{className:"text-muted-foreground",children:e.nombre_marca})]})}),(0,a.jsx)(n.TableCell,{children:(0,a.jsx)("span",{className:"text-xs",children:e.nombre_acabado||"-"})}),(0,a.jsx)(n.TableCell,{className:"text-right text-xs font-mono p-1",children:eo?(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-[10px] text-muted-foreground",children:c}),(0,a.jsx)(b.Input,{type:"number",className:`h-8 text-right w-full ${x?"bg-yellow-50 border-yellow-400":""}`,value:r,onChange:a=>{let s=parseFloat(a.target.value);isNaN(s)||em(a=>({...a,[e.id_sku]:s}))}})]}):(0,a.jsx)("span",{children:r.toLocaleString("es-PE",{style:"currency",currency:c})})}),(0,a.jsx)(n.TableCell,{className:`text-right text-base ${m?"text-red-600 font-bold":u?"text-green-600 font-bold":"text-gray-500"}`,children:s.toLocaleString("es-PE",{minimumFractionDigits:2})}),(0,a.jsx)(n.TableCell,{className:"text-right font-mono text-xs",children:l.toLocaleString("es-PE",{style:"currency",currency:"PEN"})}),(0,a.jsx)(n.TableCell,{className:"text-right font-medium text-xs",children:t.toLocaleString("es-PE",{style:"currency",currency:"PEN"})}),(0,a.jsx)(n.TableCell,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,a.jsx)(Q,{product:e,children:(0,a.jsx)(o.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",children:(0,a.jsx)(d.Search,{className:"h-3 w-3"})})}),(0,a.jsx)(o.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>et(e),title:"Ajuste Stock",children:(0,a.jsx)("div",{className:"text-[10px] font-bold border rounded px-1",children:"¬±"})}),(0,a.jsx)(o.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:async()=>{try{let a=await i.catApi.getProductoBySku(e.id_sku);ea(a),Z(!0)}catch(a){ea(e),Z(!0)}},children:(0,a.jsx)(h.Pencil,{className:"h-3 w-3 text-blue-500"})}),(0,a.jsx)(o.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>el(e.id_sku),children:(0,a.jsx)(j.Trash2,{className:"h-3 w-3 text-red-500"})})]})})]},e.id_sku)})})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-4 border-t",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Mostrando ",eh.length>0?U*O+1:0," a ",Math.min((U+1)*O,ej)," de ",ej," productos"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(o.Button,{variant:"outline",size:"sm",onClick:()=>H(e=>Math.max(0,e-1)),disabled:0===U||ex,children:"Anterior"}),(0,a.jsxs)("div",{className:"text-sm font-medium",children:["P√°gina ",U+1," de ",eg||1]}),(0,a.jsx)(o.Button,{variant:"outline",size:"sm",onClick:()=>H(e=>Math.min(eg-1,e+1)),disabled:U>=eg-1||ex,children:"Siguiente"})]})]})]}),(0,a.jsx)(J,{open:!!er,onOpenChange:e=>!e&&et(null),product:er}),(0,a.jsx)(X,{open:!!ei,onOpenChange:e=>!e&&en(null),product:ei}),(0,a.jsx)(N.Dialog,{open:Y,onOpenChange:e=>!e&&Z(!1),children:(0,a.jsxs)(N.DialogContent,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(N.DialogHeader,{children:[(0,a.jsx)(N.DialogTitle,{children:"Editar Producto"}),(0,a.jsx)(N.DialogDescription,{children:"Modifique los datos del SKU."})]}),ee&&(0,a.jsx)(w,{initialData:ee,onSuccess:()=>{Z(!1),ea(null)}})]})}),(0,a.jsx)(N.Dialog,{open:!!es,onOpenChange:e=>!e&&el(null),children:(0,a.jsxs)(N.DialogContent,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(N.DialogHeader,{children:[(0,a.jsx)(N.DialogTitle,{children:"¬øEst√° seguro?"}),(0,a.jsxs)(N.DialogDescription,{children:["Esta acci√≥n eliminar√° permanentemente el SKU ",(0,a.jsx)("b",{children:es}),". Si tiene stock o movimientos, podr√≠a causar inconsistencias."]})]}),(0,a.jsxs)(N.DialogFooter,{children:[(0,a.jsx)(o.Button,{variant:"outline",onClick:()=>el(null),children:"Cancelar"}),(0,a.jsx)(o.Button,{variant:"destructive",onClick:()=>es&&ep.mutate(es),children:"Eliminar"})]})]})})]})}let Y=(0,u.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);function Z({onSuccess:e,initialData:s}){let n=(0,t.useQueryClient)(),{toast:c}=(0,k.useToast)(),{data:d}=(0,l.useQuery)({queryKey:["mstFamilias"],queryFn:i.catApi.getFamilias}),{data:m}=(0,l.useQuery)({queryKey:["mstSistemas"],queryFn:i.catApi.getSistemas}),u=(0,_.useForm)({resolver:(0,f.zodResolver)(L),defaultValues:{id_plantilla:s?.id_plantilla||"",nombre_generico:s?.nombre_generico||"",id_familia:s?.id_familia||"",id_sistema:s?.id_sistema||"",largo_estandar_mm:s?.largo_estandar_mm?Number(s.largo_estandar_mm):0,peso_teorico_kg:s?.peso_teorico_kg?Number(s.peso_teorico_kg):0,imagen_ref:s?.imagen_ref||""}}),x=(0,r.useMutation)({mutationFn:i.catApi.createPlantilla,onSuccess:()=>{n.invalidateQueries({queryKey:["catPlantillas"]}),c({title:"Plantilla creada correctamente",variant:"default"}),e()},onError:e=>{c({title:"Error al crear plantilla: "+e.message,variant:"destructive"})}}),h=(0,r.useMutation)({mutationFn:e=>i.catApi.updatePlantilla(s.id_plantilla,e),onSuccess:()=>{n.invalidateQueries({queryKey:["catPlantillas"]}),c({title:"Plantilla actualizada correctamente",variant:"default"}),e()},onError:e=>{c({title:"Error al actualizar plantilla: "+e.message,variant:"destructive"})}}),j=x.isPending||h.isPending;return(0,a.jsx)(F.Form,{...u,children:(0,a.jsxs)("form",{onSubmit:u.handleSubmit(e=>{s?h.mutate(e):x.mutate(e)}),className:"space-y-4",children:[(0,a.jsx)(F.FormField,{control:u.control,name:"id_plantilla",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"ID Plantilla (C√≥digo √önico)"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{placeholder:"Ej. FE80, 2020, PVNT",...e,value:e.value||"",disabled:!!s,className:s?"bg-muted font-mono":"font-mono"})}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:u.control,name:"nombre_generico",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Nombre Gen√©rico"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{placeholder:"Ej. Felpa 80, Perfil Vertical Nave Top",...e})}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(F.FormField,{control:u.control,name:"id_familia",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Familia"}),(0,a.jsxs)(C.Select,{onValueChange:e.onChange,defaultValue:e.value||void 0,children:[(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{placeholder:"Seleccione familia"})})}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"null",children:"-- Ninguna --"}),d?.map(e=>(0,a.jsxs)(C.SelectItem,{value:e.id_familia,children:[e.nombre_familia," (",e.id_familia,")"]},e.id_familia))]})]}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:u.control,name:"id_sistema",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Sistema (Opcional)"}),(0,a.jsxs)(C.Select,{onValueChange:e.onChange,defaultValue:e.value||void 0,children:[(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{placeholder:"Seleccione sistema"})})}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"null",children:"-- Ninguno --"}),m?.map(e=>(0,a.jsxs)(C.SelectItem,{value:e.id_sistema,children:[e.nombre_comercial," (",e.id_sistema,")"]},e.id_sistema))]})]}),(0,a.jsx)(F.FormMessage,{})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(F.FormField,{control:u.control,name:"largo_estandar_mm",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Largo Est√°ndar (mm)"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{type:"number",step:"0.01",...e,value:e.value??0,onChange:a=>e.onChange(Number(a.target.value))})}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)(F.FormField,{control:u.control,name:"peso_teorico_kg",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"Peso Te√≥rico (Kg/m)"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{type:"number",step:"0.001",...e,value:e.value??0,onChange:a=>e.onChange(Number(a.target.value))})}),(0,a.jsx)(F.FormMessage,{})]})})]}),(0,a.jsx)(F.FormField,{control:u.control,name:"imagen_ref",render:({field:e})=>(0,a.jsxs)(F.FormItem,{children:[(0,a.jsx)(F.FormLabel,{children:"URL Imagen Referencial"}),(0,a.jsx)(F.FormControl,{children:(0,a.jsx)(b.Input,{placeholder:"https://...",...e,value:e.value||""})}),(0,a.jsx)(F.FormMessage,{})]})}),(0,a.jsx)("div",{className:"flex justify-end pt-4",children:(0,a.jsxs)(o.Button,{type:"submit",disabled:j,children:[j&&(0,a.jsx)(S.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),s?"Actualizar Plantilla":"Crear Plantilla"]})})]})})}function ee(){let e=(0,t.useQueryClient)(),{toast:s}=(0,k.useToast)(),{data:m,isLoading:u}=(0,l.useQuery)({queryKey:["catPlantillas"],queryFn:i.catApi.getPlantillas}),[x,g]=(0,v.useState)(""),[p,_]=(0,v.useState)(!1),[f,S]=(0,v.useState)(null),[F,C]=(0,v.useState)(null),[y,T]=(0,v.useState)(!1),L=(0,r.useMutation)({mutationFn:i.catApi.deletePlantilla,onSuccess:()=>{e.invalidateQueries({queryKey:["catPlantillas"]}),s({title:"Plantilla eliminada correctamente",variant:"default"}),C(null),T(!1)},onError:e=>{s({title:"Error al eliminar plantilla: "+e.message,variant:"destructive"}),C(null),T(!1)}}),P=m?.filter(e=>e.nombre_generico.toLowerCase().includes(x.toLowerCase())||e.mst_familias?.nombre_familia.toLowerCase().includes(x.toLowerCase()))||[];return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center gap-4",children:[(0,a.jsxs)("div",{className:"relative max-w-sm w-full",children:[(0,a.jsx)(d.Search,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(b.Input,{placeholder:"Buscar plantilla...",className:"pl-8",value:x,onChange:e=>g(e.target.value)})]}),(0,a.jsxs)(N.Dialog,{open:p,onOpenChange:_,children:[(0,a.jsx)(N.DialogTrigger,{asChild:!0,children:(0,a.jsxs)(o.Button,{children:[(0,a.jsx)(c.Plus,{className:"mr-2 h-4 w-4"}),"Nueva Plantilla"]})}),(0,a.jsxs)(N.DialogContent,{children:[(0,a.jsxs)(N.DialogHeader,{children:[(0,a.jsx)(N.DialogTitle,{children:"Crear Nueva Plantilla"}),(0,a.jsx)(N.DialogDescription,{children:'Define un nuevo "recetario" base para productos manufacturados.'})]}),(0,a.jsx)(Z,{onSuccess:()=>_(!1)})]})]})]}),(0,a.jsx)("div",{className:"border rounded-md bg-white dark:bg-gray-800",children:(0,a.jsxs)(n.Table,{children:[(0,a.jsx)(n.TableHeader,{children:(0,a.jsxs)(n.TableRow,{children:[(0,a.jsx)(n.TableHead,{className:"w-[80px]",children:"ID"}),(0,a.jsx)(n.TableHead,{children:"Nombre Gen√©rico"}),(0,a.jsx)(n.TableHead,{children:"Familia"}),(0,a.jsx)(n.TableHead,{children:"Sistema"}),(0,a.jsx)(n.TableHead,{className:"text-right",children:"Largo Est√°ndar"}),(0,a.jsx)(n.TableHead,{className:"text-right",children:"Peso Te√≥rico"}),(0,a.jsx)(n.TableHead,{className:"text-center",children:"Ref."}),(0,a.jsx)(n.TableHead,{className:"text-right",children:"Acciones"})]})}),(0,a.jsx)(n.TableBody,{children:u?(0,a.jsx)(n.TableRow,{children:(0,a.jsx)(n.TableCell,{colSpan:8,className:"text-center h-24",children:"Cargando plantillas..."})}):0===P.length?(0,a.jsx)(n.TableRow,{children:(0,a.jsx)(n.TableCell,{colSpan:8,className:"text-center h-24",children:"No se encontraron plantillas."})}):P.map(e=>(0,a.jsxs)(n.TableRow,{children:[(0,a.jsx)(n.TableCell,{className:"font-mono text-xs font-medium",children:e.id_plantilla}),(0,a.jsx)(n.TableCell,{className:"font-medium",children:e.nombre_generico}),(0,a.jsx)(n.TableCell,{children:e.mst_familias?.nombre_familia}),(0,a.jsx)(n.TableCell,{children:e.mst_series_equivalencias?.nombre_comercial||"-"}),(0,a.jsx)(n.TableCell,{className:"text-right",children:e.largo_estandar_mm?`${Number(e.largo_estandar_mm).toLocaleString()} mm`:"-"}),(0,a.jsx)(n.TableCell,{className:"text-right",children:e.peso_teorico_kg?`${Number(e.peso_teorico_kg).toFixed(3)} Kg/m`:"-"}),(0,a.jsx)(n.TableCell,{className:"text-center",children:e.imagen_ref?(0,a.jsx)("a",{href:e.imagen_ref,target:"_blank",rel:"noreferrer",className:"inline-flex items-center justify-center",children:(0,a.jsx)(Y,{className:"h-4 w-4 text-blue-500"})}):(0,a.jsx)("span",{className:"text-muted-foreground",children:"-"})}),(0,a.jsx)(n.TableCell,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(o.Button,{variant:"ghost",size:"icon",onClick:()=>S(e),children:(0,a.jsx)(h.Pencil,{className:"h-4 w-4 text-gray-500"})}),(0,a.jsx)(o.Button,{variant:"ghost",size:"icon",onClick:()=>{C(e.id_plantilla),T(!0)},children:(0,a.jsx)(j.Trash2,{className:"h-4 w-4 text-red-500"})})]})})]},e.id_plantilla))})]})}),(0,a.jsx)(N.Dialog,{open:!!f,onOpenChange:e=>!e&&S(null),children:(0,a.jsxs)(N.DialogContent,{children:[(0,a.jsxs)(N.DialogHeader,{children:[(0,a.jsx)(N.DialogTitle,{children:"Editar Plantilla"}),(0,a.jsx)(N.DialogDescription,{children:"Modificar los datos de la plantilla existente."})]}),f&&(0,a.jsx)(Z,{initialData:f,onSuccess:()=>S(null)})]})}),(0,a.jsx)(N.Dialog,{open:y,onOpenChange:T,children:(0,a.jsxs)(N.DialogContent,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(N.DialogHeader,{children:[(0,a.jsx)(N.DialogTitle,{children:"¬øEst√° seguro?"}),(0,a.jsx)(N.DialogDescription,{children:"Esta acci√≥n no se puede deshacer. Eliminar√° la plantilla permanentemente. Aseg√∫rese de que no haya productos vinculados a esta plantilla antes de eliminarla."})]}),(0,a.jsxs)(N.DialogFooter,{children:[(0,a.jsx)(o.Button,{variant:"outline",onClick:()=>T(!1),children:"Cancelar"}),(0,a.jsx)(o.Button,{variant:"destructive",onClick:()=>F&&L.mutate(F),children:"Eliminar"})]})]})})]})}function ea(){return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-baseline gap-2 md:gap-4 border-b pb-2",children:[(0,a.jsx)("h2",{className:"text-xl font-bold tracking-tight",children:"Cat√°logo de Productos"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Gestione las plantillas de productos terminados (ventanas, puertas) y los SKUs de materiales."})]}),(0,a.jsxs)(s.Tabs,{defaultValue:"items",className:"space-y-4",children:[(0,a.jsxs)(s.TabsList,{children:[(0,a.jsx)(s.TabsTrigger,{value:"plantillas",children:"Plantillas (Modelos)"}),(0,a.jsx)(s.TabsTrigger,{value:"items",children:"Items (Insumos/SKUs)"})]}),(0,a.jsx)(s.TabsContent,{value:"plantillas",className:"space-y-4",children:(0,a.jsxs)("div",{className:"p-4 border rounded-lg bg-white dark:bg-gray-800",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Gesti√≥n de Plantillas"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:'Aqu√≠ definir√° los "Recetarios" para ventanas, mamparas, etc.'}),(0,a.jsx)(ee,{})]})}),(0,a.jsx)(s.TabsContent,{value:"items",className:"space-y-4",children:(0,a.jsxs)("div",{className:"p-4 border rounded-lg bg-white dark:bg-gray-800",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Gesti√≥n de SKUs"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Listado de perfiles, vidrios, accesorios y otros materiales comprables."}),(0,a.jsx)(W,{active:!0})]})})]})]})}e.s(["default",()=>ea],78072)}]);