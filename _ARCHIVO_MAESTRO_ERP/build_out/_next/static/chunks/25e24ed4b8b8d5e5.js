(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70065,e=>{"use strict";var a=e.i(43476),t=e.i(71645),o=e.i(47163);let r=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,o.cn)("rounded-xl border bg-card text-card-foreground shadow",e),...t}));r.displayName="Card";let i=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",e),...t}));i.displayName="CardHeader";let s=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("h3",{ref:r,className:(0,o.cn)("font-semibold leading-none tracking-tight",e),...t}));s.displayName="CardTitle";let c=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("p",{ref:r,className:(0,o.cn)("text-sm text-muted-foreground",e),...t}));c.displayName="CardDescription";let n=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,o.cn)("p-6 pt-0",e),...t}));n.displayName="CardContent";let l=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,o.cn)("flex items-center p-6 pt-0",e),...t}));l.displayName="CardFooter",e.s(["Card",()=>r,"CardContent",()=>n,"CardDescription",()=>c,"CardFooter",()=>l,"CardHeader",()=>i,"CardTitle",()=>s])},41741,e=>{"use strict";var a=e.i(20755);e.s(["cotizacionesApi",0,{getCotizaciones:async()=>{let{data:e,error:t}=await a.supabase.from("vw_cotizaciones_totales").select(`
                *,
                mst_clientes (nombre_completo)
            `).order("fecha_emision",{ascending:!1});if(t)throw t;return e},getCotizacionById:async e=>{let{data:t,error:o}=await a.supabase.from("vw_cotizaciones_totales").select("*, mst_clientes(*)").eq("id_cotizacion",e).single();if(o)throw o;let{data:r,error:i}=await a.supabase.from("vw_cotizaciones_detalladas").select("*").eq("id_cotizacion",e);if(i)throw i;return{...t,detalles:r}},createCotizacion:async e=>{let{data:t}=await a.supabase.from("mst_config_general").select("markup_cotizaciones_default, costo_mo_m2_default").single(),o=t?.markup_cotizaciones_default||.35,r=t?.costo_mo_m2_default||0,{data:i,error:s}=await a.supabase.from("trx_cotizaciones_cabecera").insert({id_cliente:e.id_cliente,nombre_proyecto:e.nombre_proyecto,id_marca:e.id_marca,estado:"Borrador",moneda:e.moneda||"PEN",validez_dias:15,incluye_igv:!0,markup_aplicado:o,costo_mano_obra_m2:r}).select().single();if(console.log("API createCotizacion result:",i,s),s)throw s;return i},updateCotizacion:async(e,t)=>{let{data:o,error:r}=await a.supabase.from("trx_cotizaciones_cabecera").update(t).eq("id_cotizacion",e).select().single();if(r)throw r;return o},updateEstado:async(e,t,o)=>{let r={estado:t},i=new Date().toISOString();"Aprobada"===t?(r.fecha_aprobacion=i,r.fecha_rechazo=null,r.motivo_rechazo=null):"Rechazada"===t?(r.fecha_rechazo=i,r.motivo_rechazo=o,r.fecha_aprobacion=null):"Finalizada"===t?r.fecha_entrega_real=i:"Borrador"===t&&(r.fecha_aprobacion=null,r.fecha_rechazo=null,r.motivo_rechazo=null);let{data:s,error:c}=await a.supabase.from("trx_cotizaciones_cabecera").update(r).eq("id_cotizacion",e).select().single();if(c)throw c;return s},addLineItem:async(e,t)=>{let{data:o,error:r}=await a.supabase.from("trx_cotizaciones_detalle").insert({id_cotizacion:e,id_modelo:t.id_modelo,color_perfiles:t.color_perfiles,cantidad:t.cantidad,ancho_mm:t.ancho_mm,alto_mm:t.alto_mm,tipo_vidrio:t.tipo_vidrio,tipo_cierre:t.tipo_cierre,etiqueta_item:t.etiqueta_item,ubicacion:t.ubicacion,opciones_seleccionadas:t.opciones_seleccionadas||{}}).select().single();if(r)throw r;return o},triggerDespiece:async e=>{let{error:t}=await a.supabase.rpc("fn_generar_despiece_ingenieria",{p_id_linea_cot:e});if(t)throw t;return!0},addDesgloseItem:async e=>{let{data:t,error:o}=await a.supabase.from("trx_desglose_materiales").insert(e).select();if(o)throw o;return t},updateDesgloseItem:async(e,t)=>{let{data:o,error:r}=await a.supabase.from("trx_desglose_materiales").update({nombre_componente:t.nombre_componente,sku_real:t.sku_real,cantidad_calculada:t.cantidad_calculada,costo_total_item:t.costo_total_item,tipo_componente:t.tipo_componente,medida_corte_mm:t.medida_corte_mm,detalle_formula:t.detalle_formula}).eq("id_desglose",e).select();if(r)throw r;return o},deleteDesgloseItem:async e=>{let{error:t}=await a.supabase.from("trx_desglose_materiales").delete().eq("id_desglose",e);if(t)throw t;return!0},setManualFlag:async(e,t)=>{let{error:o}=await a.supabase.from("trx_cotizaciones_detalle").update({es_despiece_manual:t}).eq("id_linea_cot",e);if(o)throw o;return!0},getDesgloseMateriales:async e=>{let{data:t,error:o}=await a.supabase.from("trx_desglose_materiales").select("*").eq("id_linea_cot",e);if(o)throw o;return t},getReporteDesglose:async e=>{let{data:t,error:o}=await a.supabase.from("vw_reporte_desglose").select("*").eq("id_cotizacion",e);if(o)throw o;return t},getSistemas:async()=>{let{data:e,error:t}=await a.supabase.from("mst_series_equivalencias").select("*").order("nombre_comercial");if(t)throw t;return e},getRecetasIDs:async()=>{let{data:e,error:t}=await a.supabase.from("mst_recetas_modelos").select("id_modelo, id_sistema").eq("activo",!0).order("id_modelo");if(t)throw t;return e},getModelosBySistema:async e=>{let{data:t,error:o}=await a.supabase.from("mst_recetas_modelos").select("id_modelo, nombre_comercial, descripcion").eq("id_sistema",e).eq("activo",!0).order("id_modelo");if(o)throw o;return t},getModelos:async()=>{let{data:e,error:t}=await a.supabase.from("mst_recetas_modelos").select("id_modelo").eq("activo",!0).order("id_modelo");if(t)throw t;return e},getVidrios:async()=>{let{data:e,error:t}=await a.supabase.from("cat_productos_variantes").select(`
                id_sku,
                nombre_completo,
                costo_mercado_unit,
                es_templado,
                espesor_mm,
                cat_plantillas!inner(id_familia)
            `).eq("cat_plantillas.id_familia","VID").order("nombre_completo");if(t)throw t;return e},clonarCotizacion:async e=>{let{data:t,error:o}=await a.supabase.rpc("fn_clonar_cotizacion",{p_id_cotizacion:e});if(o)throw o;return t},clonarItem:async e=>{let{data:t,error:o}=await a.supabase.rpc("fn_clonar_item_cotizacion",{p_id_linea_cot:e});if(o)throw o;return t},updateLineItems:async(e,t)=>{let{data:o,error:r}=await a.supabase.from("trx_cotizaciones_detalle").update(t).in("id_linea_cot",e).select();if(r)throw r;return o},deleteLineItem:async e=>{let{error:t}=await a.supabase.from("trx_cotizaciones_detalle").delete().eq("id_linea_cot",e);if(t)throw t;return!0},deleteCotizacion:async e=>{let{error:t}=await a.supabase.from("trx_cotizaciones_cabecera").delete().eq("id_cotizacion",e);if(t)throw t;return!0},getAcabados:async()=>{let{data:e,error:t}=await a.supabase.from("mst_acabados_colores").select("*").in("id_acabado",["BLA","CHA","MAD","MAT","NEG"]).order("nombre_acabado");if(t)throw t;return e},getClientes:async()=>{let{data:e,error:t}=await a.supabase.from("mst_clientes").select("*").order("nombre_completo");if(t)throw t;return e},getMarcas:async()=>{let{data:e,error:t}=await a.supabase.from("mst_marcas").select("*").order("nombre_marca");if(t)throw t;return e},getGlobalConfig:async()=>{let{data:e,error:t}=await a.supabase.from("mst_config_general").select("*").single();if(t)throw t;return e}}])},9306,e=>{"use strict";var a=e.i(74117);function t(){let{toast:e}=(0,a.useToast)();return{success:(a,t)=>{e({title:`✅ ${a}`,description:t,duration:3e3})},error:(a,t)=>{e({variant:"destructive",title:`❌ ${a}`,description:t,duration:5e3})},warning:(a,t)=>{e({title:`⚠️ ${a}`,description:t,className:"border-orange-500",duration:4e3})},info:(a,t)=>{e({title:`ℹ️ ${a}`,description:t,duration:3e3})},loading:(a,t)=>e({title:`⏳ ${a}`,description:t,duration:1/0})}}e.s(["useToastHelper",()=>t])},7233,e=>{"use strict";let a=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>a],7233)},27612,e=>{"use strict";let a=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>a],27612)},94179,e=>{"use strict";var a=e.i(43476),t=e.i(25913),o=e.i(47163);let r=(0,t.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i({className:e,variant:t,...i}){return(0,a.jsx)("div",{className:(0,o.cn)(r({variant:t}),e),...i})}e.s(["Badge",()=>i])},60390,e=>{"use strict";var a=e.i(43476),t=e.i(71645),o=e.i(67881),r=e.i(7233),i=e.i(27612),s=e.i(18566),c=e.i(41741),n=e.i(70065),l=e.i(94179),d=e.i(47163),m=e.i(9306);function u(){let e=(0,s.useRouter)(),u=(0,m.useToastHelper)(),[_,f]=(0,t.useState)([]),[p,h]=(0,t.useState)(!0);async function g(){try{let e=await c.cotizacionesApi.getCotizaciones();f(e||[])}catch(e){console.error(e)}finally{h(!1)}}async function b(){try{console.log("Creating new cotizacion...");let a=await c.cotizacionesApi.createCotizacion({id_cliente:void 0,nombre_proyecto:"Nuevo Proyecto"});if(console.log("Create result:",a),!a)return void u.error("Error crítico","La API no devolvió ningún dato. Intenta nuevamente.");if(!a.id_cotizacion){console.error("CRITICAL: id_cotizacion is missing in",a),u.error("Error de creación","Se creó la cotización pero no se recibió el ID. Contacta soporte.");return}console.log("Redirecting to:",a.id_cotizacion),e.push(`/cotizaciones/detalle?id=${a.id_cotizacion}`)}catch(e){console.error("Error creating cotizacion:",e),u.error("Error al crear",e.message||"No se pudo crear la cotización")}}async function w(e,a){if(e.stopPropagation(),confirm("¿Estás seguro de que quieres eliminar esta cotización? Esta acción no se puede deshacer."))try{await c.cotizacionesApi.deleteCotizacion(a),u.success("Cotización eliminada"),g()}catch(e){console.error(e),u.error("Error al eliminar",e.message)}}return((0,t.useEffect)(()=>{g()},[]),p)?(0,a.jsx)("div",{children:"Cargando..."}):(0,a.jsxs)(n.Card,{children:[(0,a.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)(n.CardTitle,{children:"Listado Reciente"}),(0,a.jsxs)(o.Button,{onClick:b,children:[(0,a.jsx)(r.Plus,{className:"mr-2 h-4 w-4"})," Nueva Cotización"]})]}),(0,a.jsx)(n.CardContent,{children:(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-muted/50",children:(0,a.jsxs)("tr",{className:"border-b text-left",children:[(0,a.jsx)("th",{className:"p-3 font-medium",children:"Proyecto"}),(0,a.jsx)("th",{className:"p-3 font-medium",children:"Cliente"}),(0,a.jsx)("th",{className:"p-3 font-medium",children:"Fecha"}),(0,a.jsx)("th",{className:"p-3 font-medium",children:"Estado"}),(0,a.jsx)("th",{className:"p-3 font-medium text-right",children:"Total"}),(0,a.jsx)("th",{className:"p-3 font-medium"})]})}),(0,a.jsxs)("tbody",{children:[_.map(t=>(0,a.jsxs)("tr",{className:"border-b hover:bg-muted/50 cursor-pointer",onClick:()=>e.push(`/cotizaciones/detalle?id=${t.id_cotizacion}`),children:[(0,a.jsx)("td",{className:"p-3 font-medium",children:t.nombre_proyecto||"Sin nombre"}),(0,a.jsx)("td",{className:"p-3 text-muted-foreground",children:t.mst_clientes?.nombre_completo||"---"}),(0,a.jsx)("td",{className:"p-3",children:new Date(t.fecha_emision).toLocaleDateString()}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)(l.Badge,{variant:"Borrador"===t.estado?"secondary":"default",children:t.estado})}),(0,a.jsx)("td",{className:"p-3 text-right font-bold text-green-600",children:(0,d.formatCurrency)(t._vc_precio_final_cliente||0)}),(0,a.jsx)("td",{className:"p-3 text-right",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),e.push(`/cotizaciones/detalle?id=${t.id_cotizacion}`)},children:"Ver"}),(0,a.jsx)(o.Button,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-700 hover:bg-red-50",onClick:e=>w(e,t.id_cotizacion),children:(0,a.jsx)(i.Trash2,{className:"h-4 w-4"})})]})})]},t.id_cotizacion)),0===_.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"p-8 text-center text-muted-foreground",children:"No hay cotizaciones registradas."})})]})]})})})]})}e.s(["CotizacionesList",()=>u])}]);