(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,11396,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(66027),l=e.i(12598),r=e.i(17931),o=e.i(67881),i=e.i(23750),n=e.i(10708),c=e.i(30374),d=e.i(62870),m=e.i(7233),u=e.i(74886),x=e.i(27612),p=e.i(55436),h=e.i(88844),f=e.i(47163),j=e.i(9306);function g({selectedModelId:e,onSelectModel:g}){let b=(0,j.useToastHelper)(),v=(0,l.useQueryClient)(),[N,y]=(0,s.useState)(""),[_,C]=(0,s.useState)(!1),[w,S]=(0,s.useState)(!1),[E,k]=(0,s.useState)(null),[A,M]=(0,s.useState)({id_modelo:"",id_sistema:"",nombre_comercial:"",num_hojas:2,descripcion:""}),[R,P]=(0,s.useState)({id_modelo:"",nombre_comercial:""}),{data:D,isLoading:T}=(0,t.useQuery)({queryKey:["recetaModelos"],queryFn:r.recetasApi.getModelos}),{data:I}=(0,t.useQuery)({queryKey:["mstSistemasRecetas"],queryFn:r.recetasApi.getSistemas}),O=Object.entries((D||[]).reduce((e,a)=>{let s=a.mst_series_equivalencias?.nombre_comercial||a.id_sistema||"Sin Sistema";return e[s]||(e[s]=[]),e[s].push(a),e},{})).reduce((e,[a,s])=>{let t=s.filter(e=>e.nombre_comercial.toLowerCase().includes(N.toLowerCase())||e.id_modelo.toLowerCase().includes(N.toLowerCase()));return t.length>0&&(e[a]=t),e},{});async function L(){try{if(!A.id_modelo||!A.nombre_comercial)return void b.warning("Datos incompletos","ID y nombre son obligatorios");await r.recetasApi.createModelo({...A,id_sistema:A.id_sistema||null,descripcion:A.descripcion||null,activo:!0}),v.invalidateQueries({queryKey:["recetaModelos"]}),b.success("Modelo creado",`${A.nombre_comercial}`),C(!1),M({id_modelo:"",id_sistema:"",nombre_comercial:"",num_hojas:2,descripcion:""}),g(A.id_modelo)}catch(e){b.error("Error",e.message||"No se pudo crear el modelo")}}async function F(){if(!E||!R.id_modelo||!R.nombre_comercial)return void b.warning("Datos incompletos","ID y nombre son obligatorios");try{await r.recetasApi.clonarModelo(E.id_modelo,R.id_modelo,R.nombre_comercial),v.invalidateQueries({queryKey:["recetaModelos"]}),b.success("Modelo duplicado",`${R.nombre_comercial}`),S(!1),g(R.id_modelo)}catch(e){b.error("Error",e.message||"No se pudo clonar el modelo")}}async function $(a){if(confirm(`\xbfEliminar "${a.nombre_comercial}" y todas sus recetas?

Esta acci\xf3n NO se puede deshacer.`))try{await r.recetasApi.deleteModelo(a.id_modelo),v.invalidateQueries({queryKey:["recetaModelos"]}),b.success("Eliminado",`Modelo ${a.nombre_comercial} eliminado`),e===a.id_modelo&&g("")}catch(e){b.error("Error",e.message||"No se pudo eliminar")}}return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-4 border-b space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-semibold text-sm text-slate-700",children:"Modelos"}),(0,a.jsxs)(o.Button,{size:"sm",variant:"outline",onClick:()=>C(!0),children:[(0,a.jsx)(m.Plus,{className:"h-3.5 w-3.5 mr-1"})," Nuevo"]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(p.Search,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),(0,a.jsx)(i.Input,{placeholder:"Buscar modelo...",value:N,onChange:e=>y(e.target.value),className:"pl-8 h-8 text-sm"})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-2",children:[T&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground p-4 text-center",children:"Cargando modelos..."}),Object.entries(O).sort(([e],[a])=>e.localeCompare(a)).map(([s,t])=>(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider px-2 py-1.5",children:s}),(0,a.jsx)("div",{className:"space-y-0.5",children:t.map(s=>(0,a.jsxs)("div",{className:(0,f.cn)("group flex items-center justify-between px-3 py-2 rounded-md cursor-pointer transition-all",e===s.id_modelo?"bg-blue-50 border border-blue-200 text-blue-900":"hover:bg-slate-50"),onClick:()=>g(s.id_modelo),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,a.jsx)(h.Package,{className:(0,f.cn)("h-4 w-4 flex-shrink-0",e===s.id_modelo?"text-blue-500":"text-slate-400")}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium truncate",children:s.nombre_comercial}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground truncate",children:[s.id_modelo," Â· ",s.num_hojas,"H"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)(o.Button,{size:"icon",variant:"ghost",className:"h-7 w-7",title:"Duplicar",onClick:e=>{e.stopPropagation(),k(s),P({id_modelo:`${s.id_modelo}_COPIA`,nombre_comercial:`${s.nombre_comercial} (Copia)`}),S(!0)},children:(0,a.jsx)(u.Copy,{className:"h-3.5 w-3.5"})}),(0,a.jsx)(o.Button,{size:"icon",variant:"ghost",className:"h-7 w-7 text-red-500",title:"Eliminar",onClick:e=>{e.stopPropagation(),$(s)},children:(0,a.jsx)(x.Trash2,{className:"h-3.5 w-3.5"})})]})]},s.id_modelo))})]},s)),!T&&0===Object.keys(O).length&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground p-4 text-center",children:N?"Sin resultados":"No hay modelos"})]}),(0,a.jsx)(c.Dialog,{open:_,onOpenChange:C,children:(0,a.jsxs)(c.DialogContent,{className:"max-w-md",children:[(0,a.jsxs)(c.DialogHeader,{children:[(0,a.jsx)(c.DialogTitle,{children:"Crear Nuevo Modelo"}),(0,a.jsx)(c.DialogDescription,{children:"Define el identificador y nombre del modelo de ventana/puerta."})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid gap-1.5",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"ID Modelo *"}),(0,a.jsx)(i.Input,{value:A.id_modelo,onChange:e=>M({...A,id_modelo:e.target.value.toUpperCase().replace(/\s/g,"_")}),placeholder:"Ej: S25_3H",className:"font-mono"})]}),(0,a.jsxs)("div",{className:"grid gap-1.5",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"Nombre Comercial *"}),(0,a.jsx)(i.Input,{value:A.nombre_comercial,onChange:e=>M({...A,nombre_comercial:e.target.value}),placeholder:"Ej: Serie 25 - 3 Hojas"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"grid gap-1.5",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"Sistema"}),(0,a.jsxs)(d.Select,{value:A.id_sistema||"NONE",onValueChange:e=>M({...A,id_sistema:"NONE"===e?"":e}),children:[(0,a.jsx)(d.SelectTrigger,{children:(0,a.jsx)(d.SelectValue,{})}),(0,a.jsxs)(d.SelectContent,{children:[(0,a.jsx)(d.SelectItem,{value:"NONE",children:"Sin sistema"}),I?.map(e=>(0,a.jsx)(d.SelectItem,{value:e.id_sistema,children:e.nombre_comercial},e.id_sistema))]})]})]}),(0,a.jsxs)("div",{className:"grid gap-1.5",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"Num. Hojas"}),(0,a.jsx)(i.Input,{type:"number",min:0,max:10,value:A.num_hojas,onChange:e=>M({...A,num_hojas:Number(e.target.value)})})]})]}),(0,a.jsxs)("div",{className:"grid gap-1.5",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"DescripciÃ³n"}),(0,a.jsx)(i.Input,{value:A.descripcion,onChange:e=>M({...A,descripcion:e.target.value}),placeholder:"DescripciÃ³n opcional"})]})]}),(0,a.jsxs)(c.DialogFooter,{children:[(0,a.jsx)(o.Button,{variant:"outline",onClick:()=>C(!1),children:"Cancelar"}),(0,a.jsx)(o.Button,{onClick:L,children:"Crear Modelo"})]})]})}),(0,a.jsx)(c.Dialog,{open:w,onOpenChange:S,children:(0,a.jsxs)(c.DialogContent,{className:"max-w-md",children:[(0,a.jsxs)(c.DialogHeader,{children:[(0,a.jsx)(c.DialogTitle,{children:"Duplicar Modelo"}),(0,a.jsxs)(c.DialogDescription,{children:['Se copiarÃ¡n todas las recetas de "',E?.nombre_comercial,'" al nuevo modelo.']})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid gap-1.5",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"Nuevo ID *"}),(0,a.jsx)(i.Input,{value:R.id_modelo,onChange:e=>P({...R,id_modelo:e.target.value.toUpperCase().replace(/\s/g,"_")}),className:"font-mono"})]}),(0,a.jsxs)("div",{className:"grid gap-1.5",children:[(0,a.jsx)(n.Label,{className:"text-xs",children:"Nuevo Nombre *"}),(0,a.jsx)(i.Input,{value:R.nombre_comercial,onChange:e=>P({...R,nombre_comercial:e.target.value})})]})]}),(0,a.jsxs)(c.DialogFooter,{children:[(0,a.jsx)(o.Button,{variant:"outline",onClick:()=>S(!1),children:"Cancelar"}),(0,a.jsx)(o.Button,{onClick:F,children:"Duplicar"})]})]})})]})}var b=e.i(71287),v=e.i(59377),N=e.i(53751),y=e.i(87607),y=y;function _({...e}){return(0,a.jsx)(y.Root,{"data-slot":"collapsible",...e})}function C({...e}){return(0,a.jsx)(y.CollapsibleTrigger,{"data-slot":"collapsible-trigger",...e})}function w({...e}){return(0,a.jsx)(y.CollapsibleContent,{"data-slot":"collapsible-content",...e})}var S=e.i(21557),E=e.i(31278),k=e.i(84765),A=e.i(44523),M=e.i(43531),R=e.i(56909),P=e.i(64659),D=e.i(63059);let T=new Set(["ancho","alto","hojas","crucesH","crucesV"]),I=new Set(["ceil","floor","round","abs","min","max"]);class O{tokens;pos;vars;constructor(e,a){this.tokens=e,this.pos=0,this.vars=a}peek(){return this.pos<this.tokens.length?this.tokens[this.pos]:null}consume(e){let a=this.tokens[this.pos];if(!a)throw Error("ExpresiÃ³n incompleta");if(e&&a.type!==e)throw Error(`Se esperaba ${e}, pero se encontr\xf3 ${a.type} ("${a.value}")`);return this.pos++,a}parse(){let e=this.parseExpression();if(this.pos<this.tokens.length)throw Error(`Token inesperado: "${this.tokens[this.pos].value}"`);return e}parseExpression(){let e=this.parseTerm();for(;this.peek()?.type==="OPERATOR"&&("+"===this.peek().value||"-"===this.peek().value);){let a=this.consume().value,s=this.parseTerm();e="+"===a?e+s:e-s}return e}parseTerm(){let e=this.parseUnary();for(;this.peek()?.type==="OPERATOR"&&("*"===this.peek().value||"/"===this.peek().value);){let a=this.consume().value,s=this.parseUnary();if("/"===a&&0===s)throw Error("DivisiÃ³n por cero");e="*"===a?e*s:e/s}return e}parseUnary(){return this.peek()?.type==="OPERATOR"&&"-"===this.peek().value?(this.consume(),-this.parsePrimary()):this.parsePrimary()}parsePrimary(){let e=this.peek();if(!e)throw Error("ExpresiÃ³n incompleta");if("NUMBER"===e.type){this.consume();let a=parseFloat(e.value);if(isNaN(a))throw Error(`N\xfamero inv\xe1lido: "${e.value}"`);return a}if("VARIABLE"===e.type){this.consume();let a=this.vars[e.value];if(void 0===a)throw Error(`Variable "${e.value}" no definida`);return a}if("FUNCTION"===e.type){let e=this.consume().value;this.consume("LPAREN");let a=[];if(this.peek()?.type!=="RPAREN")for(a.push(this.parseExpression());this.peek()?.type==="COMMA";)this.consume(),a.push(this.parseExpression());return this.consume("RPAREN"),this.callFunction(e,a)}if("LPAREN"===e.type){this.consume();let e=this.parseExpression();return this.consume("RPAREN"),e}throw Error(`Token inesperado: "${e.value}"`)}callFunction(e,a){switch(e){case"ceil":if(1!==a.length)throw Error("ceil() requiere 1 argumento");return Math.ceil(a[0]);case"floor":if(1!==a.length)throw Error("floor() requiere 1 argumento");return Math.floor(a[0]);case"round":if(1!==a.length)throw Error("round() requiere 1 argumento");return Math.round(a[0]);case"abs":if(1!==a.length)throw Error("abs() requiere 1 argumento");return Math.abs(a[0]);case"min":if(a.length<2)throw Error("min() requiere al menos 2 argumentos");return Math.min(...a);case"max":if(a.length<2)throw Error("max() requiere al menos 2 argumentos");return Math.max(...a);default:throw Error(`Funci\xf3n desconocida: "${e}"`)}}}function L(e,a){if(!e||""===e.trim())return{value:0,error:"FÃ³rmula vacÃ­a"};try{let s=function(e){let a=[],s=0,t=e.replace(/\s+/g,"");for(;s<t.length;){let e=t[s];if(/[0-9.]/.test(e)){let e="";for(;s<t.length&&/[0-9.]/.test(t[s]);)e+=t[s++];a.push({type:"NUMBER",value:e});continue}if(/[a-zA-Z_]/.test(e)){let e="";for(;s<t.length&&/[a-zA-Z0-9_]/.test(t[s]);)e+=t[s++];if(I.has(e))a.push({type:"FUNCTION",value:e});else if(T.has(e))a.push({type:"VARIABLE",value:e});else throw Error(`Variable desconocida: "${e}". Variables v\xe1lidas: ${[...T].join(", ")}`);continue}if("+-*/".includes(e)){a.push({type:"OPERATOR",value:e}),s++;continue}if("("===e){a.push({type:"LPAREN",value:"("}),s++;continue}if(")"===e){a.push({type:"RPAREN",value:")"}),s++;continue}if(","===e){a.push({type:"COMMA",value:","}),s++;continue}throw Error(`Car\xe1cter inv\xe1lido: "${e}" en posici\xf3n ${s}`)}return a}(e),t=new O(s,a).parse();if(!isFinite(t))return{value:0,error:"Resultado no finito (infinito o NaN)"};return{value:t}}catch(e){return{value:0,error:e.message||"Error desconocido"}}}function F(e){if(!e||""===e.trim())return{valid:!0};let a=L(e,{ancho:1e3,alto:1e3,hojas:2,crucesH:0,crucesV:0});return a.error?{valid:!1,error:a.error}:{valid:!0}}let $=[{key:"MARCO",label:"Marco",icon:"ðŸ—‚ï¸",mode:"perfil"},{key:"HOJAS",label:"Hojas",icon:"ðŸ“„",mode:"perfil"},{key:"ACCESORIOS_MARCO",label:"Accesorios en Marco",icon:"ðŸ”©",mode:"accesorio"},{key:"ACCESORIOS_HOJAS",label:"Accesorios en Hojas",icon:"âš™ï¸",mode:"accesorio"},{key:"INTERIOR",label:"Interior / Vidrio",icon:"ðŸªŸ",mode:"perfil"},{key:"CRUCES",label:"Cruces",icon:"âœš",mode:"perfil"},{key:"ACCESORIOS_CRUCES",label:"Accesorios en Cruces",icon:"ðŸ”§",mode:"accesorio"},{key:"GENERAL",label:"General / Servicios",icon:"ðŸ“¦",mode:"accesorio"}],B={ancho:2e3,alto:1500,hojas:2,crucesH:0,crucesV:0};function q({modelId:e}){let n=(0,j.useToastHelper)(),c=(0,l.useQueryClient)(),[d,m]=(0,s.useState)(B),[u,x]=(0,s.useState)(!1),[p,h]=(0,s.useState)({open:!1,seccion:"",mode:"perfil"}),[g,b]=(0,s.useState)({}),[v,N]=(0,s.useState)(!1),y=Object.keys(g).length>0,{data:_}=(0,t.useQuery)({queryKey:["recetaModelo",e],queryFn:()=>r.recetasApi.getModeloById(e),enabled:!!e}),{data:C,isLoading:w}=(0,t.useQuery)({queryKey:["recetasLineas",e],queryFn:()=>r.recetasApi.getRecetasByModelo(e),enabled:!!e}),{data:A}=(0,t.useQuery)({queryKey:["catPlantillasRecetas"],queryFn:r.recetasApi.getPlantillas}),{data:M}=(0,t.useQuery)({queryKey:["catVariantesAccesorios"],queryFn:r.recetasApi.getVariantesAccesorios}),P=(0,s.useMemo)(()=>C?C.map(e=>{let a=g[e.id_receta];return a?{...e,...a}:e}):[],[C,g]),D=(0,s.useMemo)(()=>({...d,hojas:_?.num_hojas||d.hojas}),[d,_]),T=(0,s.useMemo)(()=>P?P.reduce((e,a)=>{let s=a.seccion||"GENERAL";return e[s]||(e[s]=[]),e[s].push(a),e},{}):{},[P]),I=(0,s.useCallback)(async(e,a,s)=>{b(t=>({...t,[e]:{...t[e]||{},[a]:s}}))},[]),O=(0,s.useCallback)(async(e,a)=>{b(s=>({...s,[e]:{...s[e]||{},...a}}))},[]),L=(0,s.useCallback)(async()=>{if(y){N(!0);try{let a=Object.entries(g);for(let[e,s]of a)await r.recetasApi.updateRecetaLinea(e,s);b({}),c.invalidateQueries({queryKey:["recetasLineas",e]}),n.success("Receta guardada",`${a.length} componente(s) actualizado(s)`)}catch(e){n.error("Error al guardar receta",e.message)}finally{N(!1)}}},[g,y,e,c,n]),F=(0,s.useCallback)(async(e,a)=>{try{await r.recetasApi.updatePrecioAccesorio(e,a),c.invalidateQueries({queryKey:["catVariantesAccesorios"]}),n.success("Precio actualizado en catÃ¡logo",`${e}: S/ ${a}`)}catch(e){n.error("Error al actualizar precio",e.message)}},[c,n]),q=(0,s.useCallback)(async a=>{if(confirm(`\xbfEliminar "${a.nombre_componente}"?`))try{await r.recetasApi.deleteRecetaLinea(a.id_receta),b(e=>{let s={...e};return delete s[a.id_receta],s}),c.invalidateQueries({queryKey:["recetasLineas",e]}),n.success("Eliminado",a.nombre_componente)}catch(e){n.error("Error",e.message)}},[e,c,n]);return e?w?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)(E.Loader2,{className:"h-8 w-8 animate-spin text-blue-500"})}):(0,a.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border-b bg-slate-50 shrink-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-base font-bold",children:_?.nombre_comercial||e}),(0,a.jsxs)("p",{className:"text-[11px] text-muted-foreground font-mono",children:[e," Â· ",_?.num_hojas||"?"," hojas Â· ",P?.length||0," componentes"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(o.Button,{size:"sm",variant:"outline",className:"text-xs h-7",onClick:()=>x(!u),children:[(0,a.jsx)(k.Settings2,{className:"h-3 w-3 mr-1"})," Variables"]}),(0,a.jsxs)(o.Button,{size:"sm",className:(0,f.cn)("text-xs h-7 gap-1",y?"bg-green-600 hover:bg-green-700 text-white animate-pulse":"bg-slate-200 text-slate-400 cursor-not-allowed"),disabled:!y||v,onClick:L,children:[v?(0,a.jsx)(E.Loader2,{className:"h-3 w-3 animate-spin"}):(0,a.jsx)(R.Save,{className:"h-3 w-3"}),v?"Guardando...":y?`Guardar Receta (${Object.keys(g).length})`:"Guardado âœ“"]})]})]}),u&&(0,a.jsxs)("div",{className:"px-4 py-1.5 bg-blue-50 border-b flex items-center gap-3 shrink-0 flex-wrap",children:[(0,a.jsx)("span",{className:"text-[10px] text-blue-600 font-semibold",children:"PREVIEW:"}),["ancho","alto","hojas","crucesH","crucesV"].map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-1 text-[11px]",children:[(0,a.jsxs)("span",{className:"font-medium text-blue-700",children:[e,":"]}),(0,a.jsx)(i.Input,{type:"number",className:"w-16 h-5 text-[11px] font-mono px-1 bg-white border-blue-200",value:d[e],onChange:a=>m(s=>({...s,[e]:Number(a.target.value)}))})]},e))]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:$.map(e=>(0,a.jsx)(H,{sec:e,lines:T[e.key]||[],pvars:D,plantillas:A||[],variantes:M||[],onSave:I,onSaveMulti:O,onUpdateCatalogPrice:F,onDelete:q,onAdd:()=>h({open:!0,seccion:e.key,mode:e.mode})},e.key))}),(0,a.jsx)(W,{open:p.open,seccion:p.seccion,mode:p.mode,modelId:e,modelo:_,plantillas:A||[],variantes:M||[],pvars:D,onClose:()=>h({open:!1,seccion:"",mode:"perfil"}),onCreated:()=>{c.invalidateQueries({queryKey:["recetasLineas",e]}),h({open:!1,seccion:"",mode:"perfil"})}})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:(0,a.jsxs)("div",{className:"text-center space-y-2",children:[(0,a.jsx)(S.Calculator,{className:"h-12 w-12 mx-auto text-slate-300"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"Selecciona un modelo"}),(0,a.jsx)("p",{className:"text-sm",children:"Elige un modelo del panel izquierdo"})]})})}function H({sec:e,lines:t,pvars:l,plantillas:r,variantes:i,onSave:n,onSaveMulti:c,onUpdateCatalogPrice:d,onDelete:u,onAdd:x}){let[p,h]=(0,s.useState)(t.length>0);return(0,a.jsx)(_,{open:p,onOpenChange:h,children:(0,a.jsxs)("div",{className:"border-b",children:[(0,a.jsx)(C,{asChild:!0,children:(0,a.jsxs)("button",{className:(0,f.cn)("w-full flex items-center gap-2 px-4 py-1.5 text-sm font-semibold transition-colors text-left",p?"bg-slate-100 text-slate-800":"bg-white hover:bg-slate-50 text-slate-500"),children:[p?(0,a.jsx)(P.ChevronDown,{className:"h-3.5 w-3.5"}):(0,a.jsx)(D.ChevronRight,{className:"h-3.5 w-3.5"}),e.icon," ",e.label,(0,a.jsx)("span",{className:"text-[10px] bg-slate-200 text-slate-600 px-1.5 rounded-full ml-1",children:t.length})]})}),(0,a.jsxs)(w,{children:["perfil"===e.mode?(0,a.jsx)(V,{lines:t,pvars:l,plantillas:r,onSave:n,onDelete:u}):(0,a.jsx)(z,{lines:t,pvars:l,variantes:i,onSave:n,onSaveMulti:c,onUpdateCatalogPrice:d,onDelete:u}),(0,a.jsx)("div",{className:"px-3 py-1 bg-slate-50 border-t",children:(0,a.jsxs)(o.Button,{size:"sm",variant:"ghost",className:"text-[11px] h-6 text-blue-600",onClick:x,children:[(0,a.jsx)(m.Plus,{className:"h-3 w-3 mr-1"})," Agregar componente"]})})]})]})})}function V({lines:e,pvars:s,plantillas:t,onSave:l,onDelete:r}){return 0===e.length?(0,a.jsx)("div",{className:"px-4 py-3 text-xs text-slate-400 italic",children:"Sin perfiles en esta secciÃ³n"}):(0,a.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-blue-50/60 text-blue-900 border-b text-[11px]",children:[(0,a.jsx)("th",{className:"text-left py-1.5 px-3 font-semibold w-[200px]",children:"Perfil (Plantilla)"}),(0,a.jsx)("th",{className:"text-left py-1.5 px-2 font-semibold w-[180px]",children:"FÃ³rmula de Cantidad"}),(0,a.jsx)("th",{className:"text-left py-1.5 px-2 font-semibold",children:"FÃ³rmula de Perfil (mm â†’ ML)"}),(0,a.jsx)("th",{className:"text-center py-1.5 px-2 font-semibold w-[60px]",children:"Ãngulo"}),(0,a.jsx)("th",{className:"text-right py-1.5 px-2 font-semibold w-[120px]",children:"Preview"}),(0,a.jsx)("th",{className:"w-[30px]"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsx)(U,{line:e,pvars:s,plantillas:t,onSave:l,onDelete:r},e.id_receta))})]})}function U({line:e,pvars:t,plantillas:l,onSave:r,onDelete:o}){let i=(0,s.useMemo)(()=>e.formula_cantidad?L(e.formula_cantidad,t):null,[e.formula_cantidad,t]),n=(0,s.useMemo)(()=>e.formula_perfil?L(e.formula_perfil,t):null,[e.formula_perfil,t]),c=n&&!n.error?n.value/1e3:null;return(0,a.jsxs)("tr",{className:"border-b border-slate-100 hover:bg-blue-50/20 group",children:[(0,a.jsx)("td",{className:"py-1 px-3",children:(0,a.jsx)(K,{value:e.id_plantilla||"",plantillas:l,onChange:a=>r(e.id_receta,"id_plantilla",a||null)})}),(0,a.jsx)("td",{className:"py-1 px-2",children:(0,a.jsx)(G,{value:e.formula_cantidad||"",pvars:t,onSave:a=>r(e.id_receta,"formula_cantidad",a||null),placeholder:"Ej: 2"})}),(0,a.jsx)("td",{className:"py-1 px-2",children:(0,a.jsx)(G,{value:e.formula_perfil||"",pvars:t,onSave:a=>r(e.id_receta,"formula_perfil",a||null),placeholder:"Ej: ancho-16"})}),(0,a.jsx)("td",{className:"py-1 px-2 text-center",children:(0,a.jsxs)("select",{className:"bg-transparent border-0 text-center text-xs w-14 cursor-pointer hover:bg-blue-50 rounded py-0.5",value:e.angulo??90,onChange:a=>r(e.id_receta,"angulo",Number(a.target.value)),children:[(0,a.jsx)("option",{value:90,children:"90Â°"}),(0,a.jsx)("option",{value:45,children:"45Â°"}),(0,a.jsx)("option",{value:0,children:"0Â°"})]})}),(0,a.jsxs)("td",{className:"py-1 px-2 text-right font-mono text-[10px] whitespace-nowrap",children:[i&&!i.error&&(0,a.jsxs)("span",{className:"text-emerald-600 font-semibold",children:["Ã—",i.value]}),null!==c&&(0,a.jsxs)("span",{className:"text-blue-600 ml-1.5",title:`${n.value.toFixed(0)} mm`,children:[c.toFixed(3)," ML"]}),(i?.error||n?.error)&&(0,a.jsx)("span",{className:"text-red-400",title:i?.error||n?.error,children:"âš "})]}),(0,a.jsx)("td",{className:"py-1 px-1",children:(0,a.jsx)("button",{className:"opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-600 p-0.5 transition-opacity",onClick:()=>o(e),title:"Eliminar",children:(0,a.jsx)(x.Trash2,{className:"h-3 w-3"})})})]})}function K({value:e,plantillas:t,onChange:l}){let[r,i]=(0,s.useState)(!1),[n,c]=(0,s.useState)(""),d=(0,s.useMemo)(()=>t.find(a=>a.id_plantilla===e),[t,e]),m=(0,s.useMemo)(()=>{if(!t)return[];if(!n)return t.slice(0,200);let e=n.toLowerCase();return t.filter(a=>a.id_plantilla?.toLowerCase().includes(e)||a.nombre_generico?.toLowerCase().includes(e)).slice(0,200)},[t,n]);return(0,a.jsxs)(v.Popover,{open:r,onOpenChange:i,children:[(0,a.jsx)(v.PopoverTrigger,{asChild:!0,children:(0,a.jsxs)(o.Button,{variant:"outline",role:"combobox","aria-expanded":r,className:(0,f.cn)("w-full justify-between pl-3 text-left font-normal h-8 text-xs",!e&&"text-muted-foreground",e&&"font-medium text-foreground border-primary/50"),children:[(0,a.jsx)("span",{className:"truncate",children:d?`${e} â€” ${d.nombre_generico}`:"Buscar plantilla..."}),(0,a.jsx)(A.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(v.PopoverContent,{className:"w-[400px] p-0",align:"start",children:(0,a.jsxs)(N.Command,{shouldFilter:!1,className:"overflow-visible",children:[(0,a.jsx)(N.CommandInput,{placeholder:"Buscar por cÃ³digo o nombre...",value:n,onValueChange:c}),(0,a.jsxs)(N.CommandList,{className:"max-h-[300px] overflow-y-auto overflow-x-hidden pointer-events-auto",children:[0===m.length&&(0,a.jsx)("div",{className:"py-6 text-center text-sm text-muted-foreground",children:n?"Sin resultados.":"Escribe para buscar..."}),(0,a.jsx)(N.CommandGroup,{children:m.map(s=>(0,a.jsxs)(N.CommandItem,{value:s.id_plantilla+" "+s.nombre_generico,onSelect:()=>{l(s.id_plantilla),i(!1),c("")},onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),l(s.id_plantilla),i(!1),c("")},className:(0,f.cn)("cursor-pointer pointer-events-auto","data-[selected=true]:bg-primary/20 data-[selected=true]:text-primary font-medium",e===s.id_plantilla&&"bg-primary/20 font-bold"),children:[(0,a.jsx)(M.Check,{className:(0,f.cn)("mr-2 h-4 w-4 text-primary",e===s.id_plantilla?"opacity-100":"opacity-0")}),(0,a.jsxs)("div",{className:"flex flex-col w-full",children:[(0,a.jsx)("span",{className:"font-medium font-mono",children:s.id_plantilla}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground mt-0.5",children:[(0,a.jsx)("span",{children:s.nombre_generico}),s.id_familia&&(0,a.jsx)("span",{className:"text-slate-400",children:s.id_familia})]})]})]},s.id_plantilla))})]})]})})]})}function z({lines:e,pvars:s,variantes:t,onSave:l,onSaveMulti:r,onUpdateCatalogPrice:o,onDelete:i}){return 0===e.length?(0,a.jsx)("div",{className:"px-4 py-3 text-xs text-slate-400 italic",children:"Sin accesorios en esta secciÃ³n"}):(0,a.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-amber-50/60 text-amber-900 border-b text-[11px]",children:[(0,a.jsx)("th",{className:"text-left py-1.5 px-3 font-semibold w-[250px]",children:"SKU (CatÃ¡logo)"}),(0,a.jsx)("th",{className:"text-left py-1.5 px-2 font-semibold",children:"DescripciÃ³n"}),(0,a.jsx)("th",{className:"text-left py-1.5 px-2 font-semibold w-[220px]",children:"FÃ³rmula de Cantidad"}),(0,a.jsx)("th",{className:"text-right py-1.5 px-2 font-semibold w-[80px]",children:"S/ (CatÃ¡logo)"}),(0,a.jsx)("th",{className:"text-right py-1.5 px-2 font-semibold w-[60px]",children:"Preview"}),(0,a.jsx)("th",{className:"w-[30px]"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsx)(Q,{line:e,pvars:s,variantes:t,onSave:l,onSaveMulti:r,onUpdateCatalogPrice:o,onDelete:i},e.id_receta))})]})}function Q({line:e,pvars:t,variantes:l,onSave:o,onSaveMulti:i,onUpdateCatalogPrice:n,onDelete:c}){let d=(0,s.useMemo)(()=>e.formula_cantidad?L(e.formula_cantidad,t):null,[e.formula_cantidad,t]),m=e.id_sku_catalogo||null,[u,p]=(0,s.useState)(null);(0,s.useEffect)(()=>{m?r.recetasApi.getProductoPorSku(m).then(e=>{e&&p(e)}).catch(console.error):p(null)},[m]);let h=u?.costo_mercado_unit??e.precio_unitario_manual??0;return(0,a.jsxs)("tr",{className:"border-b border-slate-100 hover:bg-amber-50/20 group",children:[(0,a.jsx)("td",{className:"py-1 px-3",children:(0,a.jsx)(b.CatalogSkuSelector,{value:m||"",onChange:function(a,s){p(s),i(e.id_receta,{id_sku_catalogo:a,nombre_componente:s?.nombre_completo||e.nombre_componente})}})}),(0,a.jsx)("td",{className:"py-1 px-2",children:(0,a.jsx)(Z,{value:e.nombre_componente,onSave:a=>o(e.id_receta,"nombre_componente",a)})}),(0,a.jsx)("td",{className:"py-1 px-2",children:(0,a.jsx)(G,{value:e.formula_cantidad||"",pvars:t,onSave:a=>o(e.id_receta,"formula_cantidad",a||null),placeholder:"Ej: hojas*2"})}),(0,a.jsx)("td",{className:"py-1 px-2 text-right",children:(0,a.jsx)(J,{value:h,onSave:function(a){m&&a>0?n(m,a):o(e.id_receta,"precio_unitario_manual",a||null)}})}),(0,a.jsxs)("td",{className:"py-1 px-2 text-right font-mono text-[10px]",children:[d&&!d.error&&(0,a.jsx)("span",{className:"text-emerald-600 font-semibold",children:Number(d.value.toFixed(2))}),d?.error&&(0,a.jsx)("span",{className:"text-red-400",title:d.error,children:"âš "})]}),(0,a.jsx)("td",{className:"py-1 px-1",children:(0,a.jsx)("button",{className:"opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-600 p-0.5 transition-opacity",onClick:()=>c(e),title:"Eliminar",children:(0,a.jsx)(x.Trash2,{className:"h-3 w-3"})})})]})}function G({value:e,pvars:t,onSave:l,placeholder:r}){let[o,i]=(0,s.useState)(e),[n,c]=(0,s.useState)(!1);(0,s.useEffect)(()=>{i(e),c(!1)},[e]);let d=(0,s.useMemo)(()=>o?F(o):null,[o]);function m(){n&&o!==e&&(l(o),c(!1))}return(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("input",{type:"text",className:(0,f.cn)("w-full bg-transparent border-0 border-b font-mono text-xs px-0 py-0.5 outline-none transition-colors",n?"border-blue-400 text-blue-800 font-medium":"border-transparent hover:border-slate-300",d&&!d.valid&&o?"border-red-400 text-red-600":""),value:o,onChange:e=>{i(e.target.value),c(!0)},onBlur:m,onKeyDown:e=>"Enter"===e.key&&m(),placeholder:r,spellCheck:!1}),n&&(0,a.jsx)("span",{className:"text-blue-400 text-[8px] shrink-0",children:"â—"})]})}function Z({value:e,onSave:t}){let[l,r]=(0,s.useState)(e),[o,i]=(0,s.useState)(!1);function n(){o&&l!==e&&l.trim()&&(t(l.trim()),i(!1))}return(0,s.useEffect)(()=>{r(e),i(!1)},[e]),(0,a.jsx)("input",{type:"text",className:(0,f.cn)("w-full bg-transparent border-0 border-b text-xs px-0 py-0.5 outline-none transition-colors text-slate-600",o?"border-blue-400":"border-transparent hover:border-slate-300"),value:l,onChange:e=>{r(e.target.value),i(!0)},onBlur:n,onKeyDown:e=>"Enter"===e.key&&n()})}function J({value:e,onSave:t}){let[l,r]=(0,s.useState)(String(e||"")),[o,i]=(0,s.useState)(!1);function n(){let a=parseFloat(l)||0;o&&a!==e&&(t(a),i(!1))}return(0,s.useEffect)(()=>{r(String(e||"")),i(!1)},[e]),(0,a.jsx)("input",{type:"text",className:(0,f.cn)("w-full bg-transparent border-0 border-b text-xs px-0 py-0.5 outline-none transition-colors text-right font-mono",o?"border-blue-400":"border-transparent hover:border-slate-300"),value:l,onChange:e=>{r(e.target.value),i(!0)},onBlur:n,onKeyDown:e=>"Enter"===e.key&&n(),placeholder:"0"})}function W({open:e,seccion:t,mode:l,modelId:n,modelo:u,plantillas:x,variantes:p,pvars:h,onClose:f,onCreated:g}){let v=(0,j.useToastHelper)(),N="perfil"===l,y=$.find(e=>e.key===t),[_,C]=(0,s.useState)({nombre:"",plantilla:"",sku:"",formulaCant:"",formulaPerfil:"",angulo:90,precio:""}),[w,S]=(0,s.useState)(!1);function k(e,a){C(s=>({...s,[e]:a}))}async function A(){S(!0);try{let e=null,a=null,s=null,l=null,o=_.nombre;if(N)e=_.plantilla||null,o=o||_.plantilla;else if(_.sku){let t=_.sku.split("-");a=t[0]||null,e=t[1]||null,s=t[2]||null,l=t[3]||null;let r=p.find(e=>e.id_sku===_.sku);o=o||r?.nombre_completo||_.sku}let i=`${n}-${e||"X"}-${Date.now()}`;await r.recetasApi.createRecetaLinea({id_receta:i,id_modelo:n,id_sistema:u?.id_sistema||null,id_plantilla:e,id_material_receta:a,id_acabado_receta:s,id_marca_receta:l,nombre_componente:o||"Nuevo componente",tipo:N?"Perfil":"Accesorio",cantidad_base:0,angulo:N?_.angulo:0,condicion:"BASE",formula_cantidad:_.formulaCant||null,formula_perfil:N&&_.formulaPerfil||null,seccion:t,orden_visual:0,precio_unitario_manual:_.precio?Number(_.precio):null}),v.success("Agregado",o||"Componente"),g()}catch(e){v.error("Error",e.message)}finally{S(!1)}}return(0,s.useEffect)(()=>{e&&C({nombre:"",plantilla:"",sku:"",formulaCant:"",formulaPerfil:"",angulo:90,precio:""})},[e]),(0,a.jsx)(c.Dialog,{open:e,onOpenChange:e=>!e&&f(),children:(0,a.jsxs)(c.DialogContent,{className:"max-w-md",children:[(0,a.jsxs)(c.DialogHeader,{children:[(0,a.jsx)(c.DialogTitle,{children:N?"Agregar Perfil":"Agregar Accesorio"}),(0,a.jsxs)(c.DialogDescription,{children:["SecciÃ³n: ",y?.icon," ",y?.label]})]}),(0,a.jsx)("div",{className:"space-y-3",children:N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-[11px] font-medium",children:"Plantilla *"}),(0,a.jsx)(K,{value:_.plantilla,plantillas:x,onChange:e=>k("plantilla",e)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-[11px] font-medium",children:"Nombre (opcional)"}),(0,a.jsx)(i.Input,{className:"h-8 text-xs",value:_.nombre,onChange:e=>k("nombre",e.target.value),placeholder:"Ej: Riel Superior"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-[11px] font-medium",children:"F. Cantidad"}),(0,a.jsx)(i.Input,{className:"h-8 text-xs font-mono",value:_.formulaCant,onChange:e=>k("formulaCant",e.target.value),placeholder:"Ej: 2"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-[11px] font-medium",children:"F. Perfil (mm)"}),(0,a.jsx)(i.Input,{className:"h-8 text-xs font-mono",value:_.formulaPerfil,onChange:e=>k("formulaPerfil",e.target.value),placeholder:"Ej: ancho-16"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-[11px] font-medium",children:"Ãngulo"}),(0,a.jsxs)(d.Select,{value:String(_.angulo),onValueChange:e=>k("angulo",Number(e)),children:[(0,a.jsx)(d.SelectTrigger,{className:"h-8 text-xs",children:(0,a.jsx)(d.SelectValue,{})}),(0,a.jsxs)(d.SelectContent,{children:[(0,a.jsx)(d.SelectItem,{value:"90",children:"90Â°"}),(0,a.jsx)(d.SelectItem,{value:"45",children:"45Â°"}),(0,a.jsx)(d.SelectItem,{value:"0",children:"0Â°"})]})]})]})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-[11px] font-medium",children:"SKU del CatÃ¡logo *"}),(0,a.jsx)(b.CatalogSkuSelector,{value:_.sku,onChange:(e,a)=>{k("sku",e),a&&(k("nombre",a.nombre_completo||""),k("precio",String(a.costo_mercado_unit||"")))}})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-[11px] font-medium",children:"DescripciÃ³n"}),(0,a.jsx)(i.Input,{className:"h-8 text-xs",value:_.nombre,onChange:e=>k("nombre",e.target.value),placeholder:"Auto-llenado del catÃ¡logo"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-[11px] font-medium",children:"Precio S/"}),(0,a.jsx)(i.Input,{type:"number",step:"0.01",className:"h-8 text-xs font-mono",value:_.precio,onChange:e=>k("precio",e.target.value),placeholder:"Del catÃ¡logo"})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-[11px] font-medium",children:"FÃ³rmula de Cantidad"}),(0,a.jsx)(i.Input,{className:"h-8 text-xs font-mono",value:_.formulaCant,onChange:e=>k("formulaCant",e.target.value),placeholder:"Ej: hojas*2   Ã³   ((2*ancho)+(4*alto))/1000"}),(0,a.jsx)("p",{className:"text-[9px] text-muted-foreground",children:"Variables: ancho, alto, hojas, crucesH, crucesV Â· Funciones: ceil, floor, round, abs, min, max"})]})]})}),(0,a.jsxs)(c.DialogFooter,{children:[(0,a.jsx)(o.Button,{variant:"outline",size:"sm",onClick:f,children:"Cancelar"}),(0,a.jsxs)(o.Button,{size:"sm",onClick:A,disabled:w||(N?!_.plantilla:!_.sku),children:[w?(0,a.jsx)(E.Loader2,{className:"h-3 w-3 animate-spin mr-1"}):(0,a.jsx)(m.Plus,{className:"h-3 w-3 mr-1"})," Agregar"]})]})]})})}var X=e.i(47627),Y=e.i(94179),ee=e.i(75254);let ea=(0,ee.default)("shield-alert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]),es=(0,ee.default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var et=e.i(16715);let el=(0,ee.default)("file-exclamation-point",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function er({onNavigate:e}){let[l,i]=(0,s.useState)(!1),{data:n,isLoading:d,refetch:m,isRefetching:u}=(0,t.useQuery)({queryKey:["recipeMassAudit"],queryFn:r.recetasApi.getAllRecetasConCatalogInfo,enabled:l}),x=(0,s.useMemo)(()=>{if(!n)return[];let e=[];return n.forEach(a=>{if(!1===a.modelo_activo)return;let s="Perfil"===a.tipo||"Vidrio"===a.tipo,t="Accesorio"===a.tipo||"Servicio"===a.tipo;if(s&&!a.id_plantilla&&e.push({...a,_errorType:"MISSING_PLANTILLA",_errorMsg:"Falta ID Plantilla"}),t&&!a.id_sku_catalogo&&e.push({...a,_errorType:"MISSING_SKU",_errorMsg:"Falta SKU"}),t&&a.id_sku_catalogo&&(a.precio_catalogo??a.precio_unitario_manual??0)<=0&&e.push({...a,_errorType:"ZERO_PRICE",_errorMsg:"Costo = S/ 0.00"}),a.formula_cantidad){let s=F(a.formula_cantidad);s.valid||e.push({...a,_errorType:"FORMULA_ERROR",_errorMsg:`Form. Cantidad: ${s.error}`})}if(a.formula_perfil){let s=F(a.formula_perfil);s.valid||e.push({...a,_errorType:"FORMULA_ERROR",_errorMsg:`Form. Perfil: ${s.error}`})}}),e},[n]),p=(0,s.useMemo)(()=>[...x].sort((e,a)=>e.modelo_nombre?.localeCompare(a.modelo_nombre)||0),[x]),h=new Set(n?.filter(e=>!1!==e.modelo_activo).map(e=>e.id_modelo)).size||0,f=n?.filter(e=>!1!==e.modelo_activo).length||0;return(0,a.jsxs)(c.Dialog,{open:l,onOpenChange:i,children:[(0,a.jsx)(c.DialogTrigger,{asChild:!0,children:(0,a.jsxs)(o.Button,{variant:"destructive",className:"gap-2 bg-red-600 hover:bg-red-700",children:[(0,a.jsx)(ea,{className:"h-4 w-4"}),"Auditar Sistema (",x.length||"?",")"]})}),(0,a.jsxs)(c.DialogContent,{className:"sm:max-w-[90vw] w-full h-[85vh] flex flex-col p-4",children:[(0,a.jsxs)(c.DialogHeader,{className:"flex flex-row items-center justify-between pb-2 shrink-0 border-b",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(c.DialogTitle,{className:"text-xl flex items-center gap-2",children:[(0,a.jsx)(el,{className:"h-5 w-5 text-red-600"}),"AuditorÃ­a de Integridad MTO"]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["El sistema ha cargado ",f," registros de ",h," modelos activos."]})]}),(0,a.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:()=>m(),disabled:u,children:[(0,a.jsx)(et.RefreshCw,{className:`h-4 w-4 mr-2 ${u?"animate-spin":""}`}),"Re-Escanear"]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto border rounded-md bg-white relative mt-4",children:d?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-slate-500 absolute inset-0",children:[(0,a.jsx)(E.Loader2,{className:"h-8 w-8 animate-spin mb-4"}),(0,a.jsx)("p",{children:"Procesando reglas matemÃ¡ticas del sistema..."})]}):0===p.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-green-600 bg-green-50/50 absolute inset-0",children:[(0,a.jsx)(ea,{className:"h-16 w-16 mb-4 opacity-30"}),(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Â¡AuditorÃ­a Perfecta!"}),(0,a.jsx)("p",{className:"text-sm text-green-700 mt-2",children:"No se encontraron errores de configuraciÃ³n ni costos nulos."})]}):(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)(X.Table,{children:[(0,a.jsx)(X.TableHeader,{className:"sticky top-0 bg-slate-50 shadow-sm z-10",children:(0,a.jsxs)(X.TableRow,{children:[(0,a.jsx)(X.TableHead,{className:"w-[200px]",children:"Modelo Afectado"}),(0,a.jsx)(X.TableHead,{className:"w-[120px]",children:"Tipo"}),(0,a.jsx)(X.TableHead,{children:"Componente"}),(0,a.jsx)(X.TableHead,{className:"w-[250px]",children:"DescripciÃ³n del Error"}),(0,a.jsx)(X.TableHead,{className:"w-[80px] text-right",children:"AcciÃ³n"})]})}),(0,a.jsx)(X.TableBody,{children:p.map((s,t)=>{let l="bg-orange-50 text-orange-700 border-orange-200";return"FORMULA_ERROR"===s._errorType&&(l="bg-red-50 text-red-700 border-red-200"),"ZERO_PRICE"===s._errorType&&(l="bg-amber-50 text-amber-700 border-amber-200"),(0,a.jsxs)(X.TableRow,{className:"hover:bg-slate-50",children:[(0,a.jsxs)(X.TableCell,{className:"font-medium",children:[(0,a.jsx)("div",{className:"text-sm text-slate-900",children:s.modelo_nombre}),(0,a.jsx)("div",{className:"text-[10px] text-slate-500 font-mono mt-0.5",children:s.id_modelo})]}),(0,a.jsx)(X.TableCell,{children:(0,a.jsx)(Y.Badge,{variant:"secondary",className:"text-[10px] font-normal",children:s.tipo})}),(0,a.jsx)(X.TableCell,{className:"text-sm text-slate-700",children:s.nombre_componente||"(Sin Nombre)"}),(0,a.jsx)(X.TableCell,{children:(0,a.jsx)("div",{className:`text-xs px-2.5 py-1 rounded-md border font-medium ${l}`,children:s._errorMsg})}),(0,a.jsx)(X.TableCell,{className:"text-right",children:(0,a.jsx)(o.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{i(!1),e(s.id_modelo)},title:"Solucionar",children:(0,a.jsx)(es,{className:"h-4 w-4 text-primary"})})})]},`${s.id_receta}-${t}`)})})]})})}),(0,a.jsxs)("div",{className:"mt-3 text-xs flex items-center justify-between shrink-0 bg-slate-50 border rounded-md px-4 py-2",children:[(0,a.jsx)("span",{className:"text-slate-600 font-medium tracking-wide uppercase",children:"DiagnÃ³stico FInal"}),d?(0,a.jsx)("div",{className:"animate-pulse w-24 h-4 bg-slate-200 rounded"}):p.length>0?(0,a.jsxs)("span",{className:"font-bold text-red-600",children:[p.length," Riesgo(s) Detectado(s) en ",new Set(p.map(e=>e.id_modelo)).size," modelo(s)"]}):(0,a.jsx)("span",{className:"font-bold text-green-600",children:"Sistema Limpio"})]})]})]})}function eo(){let[e,t]=(0,s.useState)(null);return(0,a.jsxs)("div",{className:"flex flex-col h-[calc(100vh-4rem)] p-4",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"ðŸ“ Editor de Recetas"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Gestiona las recetas de ingenierÃ­a â€” edita todos los campos, fÃ³rmulas y vÃ­nculos SKU."})]}),(0,a.jsx)(er,{onNavigate:e=>t(e||null)})]}),(0,a.jsxs)("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-[300px_1fr] gap-3 min-h-0",children:[(0,a.jsx)("div",{className:"border rounded-lg bg-white overflow-hidden flex flex-col",children:(0,a.jsx)(g,{selectedModelId:e,onSelectModel:e=>t(e||null)})}),(0,a.jsx)("div",{className:"border rounded-lg bg-white overflow-hidden flex flex-col",children:(0,a.jsx)(q,{modelId:e||""})})]})]})}e.s(["RecipeEditorPage",()=>eo],11396)}]);